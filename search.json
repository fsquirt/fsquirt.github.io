[{"title":"Mysqlæ”»ç•¥-è¿›é˜¶åŠŸèƒ½åˆ°æ›´å¤š","path":"/2026/01/04/mysql-higher/","content":"çœ‹å®Œæœ¬æ–‡ä½ å°†é€Ÿé€šï¼šçª—å£å‡½æ•°ï¼Œæ‚²è§‚ä¹è§‚é”ï¼Œå¤„ç† JSON æ•°æ®ï¼Œå¤æ‚é€»è¾‘å¤„ç†(if else)ï¼Œæ€§èƒ½åˆ†æï¼Œå­˜å‚¨è¿‡ç¨‹ä¸è§¦å‘å™¨ç­‰ç­‰é«˜çº§åŠŸèƒ½ã€‚çœ‹å®Œä½ å°±æ˜¯Mysqlé«˜æ‰‹ æ–½å·¥ä¸­ã€‚","tags":["Mysql","Database","notebook"]},{"title":"Mysqlæ”»ç•¥-é«˜çº§æŸ¥è¯¢åˆ°è¿›é˜¶åŠŸèƒ½","path":"/2026/01/02/mysql-super/","content":"ä½ ç‚¹å¼€æœ¬æ–‡æˆ‘å°±å½“ä½ å·²ç»çŸ¥é“MysqlåŸºç¡€äº†ï¼Œçœ‹å®Œæœ¬æ–‡ä½ å°†é€Ÿé€šï¼šå‡½æ•°ï¼Œåˆ†ç»„ä¸ç»Ÿè®¡ï¼Œå¤šè¡¨æŸ¥è¯¢ï¼Œå­æŸ¥è¯¢ï¼Œç´¢å¼•ï¼Œäº‹åŠ¡ï¼Œé—´éš™é”ã€‚ ç”±äºç¯‡å¹…é—®é¢˜ï¼Œçª—å£å‡½æ•°ï¼Œæ‚²è§‚ä¹è§‚é”ï¼Œå¤„ç† JSON æ•°æ®ï¼Œå¤æ‚é€»è¾‘å¤„ç†(if else)ï¼Œæ€§èƒ½åˆ†æï¼Œå­˜å‚¨è¿‡ç¨‹ä¸è§¦å‘å™¨ç­‰ç­‰é«˜çº§åŠŸèƒ½ä¼šæ”¾åˆ°ä¸‹ä¸€ç¯‡æ–‡ç« ã€‚å…¨éƒ¨çœ‹å®Œä½ å°±ç¬é—´å˜æˆMysqlé«˜æ‰‹ å…ˆç”¨ä¸‹é¢çš„pyæ¨¡æ‹Ÿä¸€å †æ•°æ®è¿›å» import pymysqlfrom faker import Fakerimport randomfrom datetime import datetime# ================= é…ç½®åŒºåŸŸ =================DB_CONFIG = host: localhost, user: root, password: 123456, # âš ï¸ è®°å¾—æ”¹ä½ çš„å¯†ç  port: 3306, charset: utf8mb4DB_NAME = mall_db_simple # ä¾ç„¶ä½¿ç”¨çº¯å‡€åº“# æ•°æ®é‡è®¾ç½®NUM_USERS = 200 # 200ä¸ªç”¨æˆ·NUM_PRODUCTS = 50 # 50ç§å•†å“NUM_ORDERS = 100 # 100ä¸ªè®¢å• (ç”Ÿæˆçš„ order_items ä¼šæœ‰ 2000~4000 æ¡)# ===========================================fake = Faker(zh_CN)def get_connection(use_db=True): conf = DB_CONFIG.copy() if use_db: conf[db] = DB_NAME return pymysql.connect(**conf)def init_db(): print(fğŸ”„ åˆå§‹åŒ–çº¯å‡€ç‰ˆæ•°æ®åº“: DB_NAME...) conn = get_connection(use_db=False) cursor = conn.cursor() cursor.execute(fCREATE DATABASE IF NOT EXISTS DB_NAME DEFAULT CHARSET utf8mb4;) cursor.execute(fUSE DB_NAME;) # æ¸…ç†æ—§è¡¨ cursor.execute(DROP TABLE IF EXISTS order_items;) cursor.execute(DROP TABLE IF EXISTS orders;) cursor.execute(DROP TABLE IF EXISTS products;) cursor.execute(DROP TABLE IF EXISTS users;) # === è¡¨ç»“æ„ä¿æŒâ€œç´ é¢œâ€ï¼ˆåªæœ‰ä¸»é”®ï¼‰ === sql_users = CREATE TABLE users ( id INT AUTO_INCREMENT PRIMARY KEY, username VARCHAR(50), email VARCHAR(100), phone VARCHAR(20), city VARCHAR(50), created_at DATETIME ); sql_products = CREATE TABLE products ( id INT AUTO_INCREMENT PRIMARY KEY, name VARCHAR(100), category VARCHAR(50), price DECIMAL(10, 2), stock INT, status TINYINT ); sql_orders = CREATE TABLE orders ( id INT AUTO_INCREMENT PRIMARY KEY, user_id INT NOT NULL, order_no VARCHAR(50), total_amount DECIMAL(12, 2), -- è¿™ä¸ªé‡‘é¢æ˜¯ç»è¿‡è®¡ç®—ç®—å‡ºæ¥çš„ status TINYINT, created_at DATETIME ); sql_order_items = CREATE TABLE order_items ( id INT AUTO_INCREMENT PRIMARY KEY, order_id INT NOT NULL, product_id INT NOT NULL, quantity INT, price DECIMAL(10, 2) ); cursor.execute(sql_users) cursor.execute(sql_products) cursor.execute(sql_orders) cursor.execute(sql_order_items) conn.commit() conn.close() print(âœ… è¡¨ç»“æ„é‡ç½®å®Œæˆï¼)def generate_data(): conn = get_connection() cursor = conn.cursor() # --- 1. ç”Ÿæˆç”¨æˆ· --- print(ğŸ‘¤ æ­£åœ¨ç”Ÿæˆç”¨æˆ·...) users_data = [] for _ in range(NUM_USERS): users_data.append((fake.name(), fake.email(), fake.phone_number(), fake.city(), fake.date_time())) cursor.executemany(INSERT INTO users (username, email, phone, city, created_at) VALUES (%s, %s, %s, %s, %s), users_data) # --- 2. ç”Ÿæˆå•†å“ --- print(ğŸ“¦ æ­£åœ¨ç”Ÿæˆå•†å“...) products_data = [] # æç‚¹çœŸå®çš„åˆ†ç±» categories = [æ•°ç , é›¶é£Ÿ, ä¹¦ç±, æœè£…, å®¶å±…] for _ in range(NUM_PRODUCTS): cat = random.choice(categories) price = random.randint(10, 2000) # ä»·æ ¼åœ¨10å—åˆ°2000å—ä¹‹é—´ products_data.append((fcat-fake.word(), cat, price, 999, 1)) cursor.executemany(INSERT INTO products (name, category, price, stock, status) VALUES (%s, %s, %s, %s, %s), products_data) conn.commit() # å‡†å¤‡ç¼“å­˜æ•°æ®ï¼Œæ–¹ä¾¿ä¸‹é¢ç”Ÿæˆè®¢å•ç”¨ cursor.execute(SELECT id FROM users) user_ids = [r[0] for r in cursor.fetchall()] cursor.execute(SELECT id, price FROM products) # å˜æˆå­—å…¸ id: priceï¼Œæ–¹ä¾¿æŸ¥ä»·æ ¼ products_map = r[0]: float(r[1]) for r in cursor.fetchall() product_ids_list = list(products_map.keys()) # --- 3. ç”Ÿæˆå¤æ‚çš„è®¢å• --- print(ğŸ“ æ­£åœ¨ç”Ÿæˆå¤æ‚è®¢å• (å¤šå•†å“/å¤šæ•°é‡)...) batch_orders = [] batch_items = [] for i in range(1, NUM_ORDERS + 1): # 3.1 éšæœºé€‰äººã€æ—¶é—´ã€çŠ¶æ€ u_id = random.choice(user_ids) created_at = fake.date_time_between(start_date=-1y, end_date=now) order_no = fORDcreated_at.strftime(%Y%m%d)i:05d status = random.choice([0, 1, 2, 3]) # 3.2 å†³å®šè¿™ä¸ªè®¢å•ä¹°å‡ ç§å•†å“ (1 åˆ° 5 ç§) items_count = random.randint(1, 5) # ä»å•†å“åº“é‡ŒéšæœºæŠ½ items_count ä¸ªå•†å“ID (ä¸é‡å¤) selected_pids = random.sample(product_ids_list, items_count) current_order_total = 0.0 # 3.3 éå†ç”Ÿæˆçš„å•†å“ï¼Œç®—é’±ï¼Œç”Ÿæˆæ˜ç»† for pid in selected_pids: # å†³å®šä¹°å‡ ä¸ª (1 åˆ° 3 ä¸ª) qty = random.randint(1, 3) price = products_map[pid] # ç´¯åŠ æ€»é‡‘é¢ current_order_total += price * qty # æ·»åŠ åˆ° items åˆ—è¡¨ (æ³¨æ„è¿™é‡Œç”¨äº† i ä½œä¸º order_id) batch_items.append((i, pid, qty, price)) # 3.4 æ·»åŠ åˆ° orders åˆ—è¡¨ batch_orders.append((u_id, order_no, current_order_total, status, created_at)) # æ¯500ä¸ªæäº¤ä¸€æ¬¡ï¼Œé˜²æ­¢åˆ—è¡¨å¤ªå¤§æ’‘çˆ†å†…å­˜ if len(batch_orders) = 500: cursor.executemany(INSERT INTO orders (user_id, order_no, total_amount, status, created_at) VALUES (%s, %s, %s, %s, %s), batch_orders) cursor.executemany(INSERT INTO order_items (order_id, product_id, quantity, price) VALUES (%s, %s, %s, %s), batch_items) conn.commit() batch_orders = [] batch_items = [] print(f ...å·²å¤„ç† i ä¸ªè®¢å•) # å¤„ç†å‰©ä¸‹çš„ if batch_orders: cursor.executemany(INSERT INTO orders (user_id, order_no, total_amount, status, created_at) VALUES (%s, %s, %s, %s, %s), batch_orders) cursor.executemany(INSERT INTO order_items (order_id, product_id, quantity, price) VALUES (%s, %s, %s, %s), batch_items) conn.commit() conn.close() print(f ğŸ‰ æå®šï¼ç”Ÿæˆäº† NUM_ORDERS ä¸ªè®¢å•ï¼ŒåŒ…å«å¤šç§å•†å“ç»„åˆã€‚)if __name__ == __main__: init_db() generate_data() å‡½æ•°Mysqlæä¾›äº†å¾ˆå¤šç±»ä¼¼äºç¼–ç¨‹è¯­è¨€çš„å‡½æ•°ï¼Œè¿›æ¥ä¸€å †è¡Œï¼Œåå‡ºä¸€ä¸ªå€¼ å‡½æ•°å ç±»å‹ ä½œç”¨ åº”ç”¨åœºæ™¯ COUNT() èšåˆ æ•°æ•° ç»Ÿè®¡ä»Šå¤©æœ‰å¤šå°‘äººæ³¨å†Œï¼šCOUNT(id) SUM() èšåˆ æ±‚å’Œ ç®—å‡ºä»Šå¤©çš„æ€»è¥ä¸šé¢ï¼šSUM(total_amount) AVG() èšåˆ å¹³å‡å€¼ ç®—å‡ºå®¢å•ä»·ï¼ˆå¹³å‡æ¯å•å¤šå°‘é’±ï¼‰ï¼šAVG(total_amount) MAX() èšåˆ æœ€å¤§å€¼ æ‰¾å‡ºæœ€è´µçš„å•†å“ä»·æ ¼ï¼šMAX(price) MIN() èšåˆ æœ€å°å€¼ æ‰¾å‡ºåº“å­˜æœ€å°‘çš„å•†å“ï¼šMIN(stock) GROUP_CONCAT() èšåˆ æ‹¼æ¥ç»“æœ æŠŠä¸€ä¸ªè®¢å•ä¹°çš„æ‰€æœ‰å•†å“åæ‹¼æˆä¸€è¡Œæ˜¾ç¤ºï¼šè–¯ç‰‡,å¯ä¹,è¾£æ¡ NOW() æ—¶é—´ å½“å‰æ—¶é—´ æ’å…¥è®¢å•æ—¶ï¼Œcreated_at å­—æ®µç”¨çš„å°±æ˜¯å®ƒ DATE_FORMAT() æ—¶é—´ æ ¼å¼åŒ– å‰ç«¯è¦æ˜¾ç¤º â€œ2026å¹´01æœˆ04æ—¥â€ï¼Œè€Œä¸æ˜¯æ•°æ®åº“é‚£ä¸²åŸæœ¬çš„è‹±æ–‡æ ¼å¼ DATEDIFF() æ—¶é—´ ç®—å¤©æ•° ç»Ÿè®¡ç”¨æˆ· â€œæ³¨å†Œäº†å¤šå°‘å¤©â€ï¼šDATEDIFF(NOW(), created_at) CONCAT() å­—ç¬¦ä¸² æ‹¼å­—ç¬¦ä¸² æ¨¡ç³Šæœç´¢æ—¶æ‹¼ like æ¡ä»¶ï¼Œæˆ–è€…æŠŠ å§“+å æ‹¼åœ¨ä¸€èµ· SUBSTR() å­—ç¬¦ä¸² æˆªå– æ‰‹æœºå·è„±æ•ï¼Œåªæ˜¾ç¤ºåå››ä½ LENGTH() å­—ç¬¦ä¸² ç®—é•¿åº¦ æ£€æŸ¥ç”¨æˆ·ç®€ä»‹æ˜¯ä¸æ˜¯å¤ªé•¿äº† IFNULL() é€»è¾‘ æ˜¯ä¸æ˜¯NULL? å¦‚æœå¤´åƒ URL æ˜¯ NULLï¼Œç»™ä¸ªé»˜è®¤å›¾ï¼šIFNULL(avatar, default.png) CASE WHEN é€»è¾‘ SQLé‡Œçš„if-else æŠŠçŠ¶æ€ 0/1 è½¬æ¢æˆä¸­æ–‡ â€œæœªæ”¯ä»˜â€â€œå·²æ”¯ä»˜â€ ä¸‹é¢çš„å†…å®¹ä¼šä½¿ç”¨åˆ°è¿™äº›å¸¸ç”¨çš„å‡½æ•°ï¼Œå¦‚æœæœ‰ç”¨åˆ°çš„å‡½æ•°æ²¡æœ‰åœ¨è¿™å¼ è¡¨ä¸Šæ˜¾ç¤ºçš„è¯ï¼Œå¯ä»¥å‰å¾€MySQL å‡½æ•° | èœé¸Ÿæ•™ç¨‹ æŸ¥çœ‹å‡½æ•°åŠŸèƒ½ åˆ†ç»„å’Œç»Ÿè®¡GROUP BY è¯­å¥æ ¹æ®ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—å¯¹ç»“æœé›†è¿›è¡Œåˆ†ç»„ã€‚ SELECT åˆ†ç»„å­—æ®µ, èšåˆå‡½æ•°(ç»Ÿè®¡å­—æ®µ)FROM è¡¨åWHERE è¿‡æ»¤æ¡ä»¶ -- (å¯é€‰) åœ¨åˆ†ç»„å‰è¿‡æ»¤åŸå§‹è¡ŒGROUP BY åˆ†ç»„å­—æ®µ -- æ ¸å¿ƒï¼šæŒ‰ä»€ä¹ˆæ¥åˆ†ç»„HAVING èšåˆåçš„è¿‡æ»¤æ¡ä»¶ -- (å¯é€‰) åœ¨åˆ†ç»„åè¿‡æ»¤ç»Ÿè®¡ç»“æœORDER BY æ’åºå­—æ®µ; -- (å¯é€‰) æ’åº ä½¿ç”¨GROUP BYåˆ†ç»„ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¯”å¦‚æˆ‘æƒ³æŸ¥çœ‹mall_db_simpleæ•°æ®åº“é‡Œï¼Œproductsè¡¨é‡Œæœ‰å¤šå°‘ç§å•†å“ç±»å‹ select category from products group by category; è¿™æ ·å°±ä¼šè¾“å‡º +----------+| category |+----------+| ä¹¦ç± || å®¶å±… || æ•°ç  || æœè£… || é›¶é£Ÿ |+----------+5 rows in set (0.0005 sec) é…åˆå‡½æ•°ä½¿ç”¨å¦‚æœæˆ‘è¿˜æƒ³çœ‹æ¯ä¸ªåˆ†ç±»æœ‰å¤šå°‘ä¸ªï¼Œä½¿ç”¨ä¸Šé¢æåˆ°çš„COUNT()å‡½æ•°æ¥è·å–ä¸ªæ•° select category,count(category) from products group by category; è¿™æ ·å°±ä¼šè¾“å‡º +----------+-----------------+| category | count(category) |+----------+-----------------+| ä¹¦ç± | 4 || å®¶å±… | 14 || æ•°ç  | 8 || æœè£… | 15 || é›¶é£Ÿ | 9 |+----------+-----------------+5 rows in set (0.0009 sec) è¿”å›çš„çš„è¡¨ä¸ªæ•°åˆ—ä¼šä½¿ç”¨sqlè¯­å¥é‡Œå†™çš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ AS å…³é”®å­—æ¥ç»™è¿™ä¸ªåˆ—å–ä¸ªåå­— select category,count(category) as category_count from products group by category; è¿™æ ·åˆ— count(category) å°±ä¼šè¢«é‡å‘½åä¸º category_count +----------+----------------+| category | category_count |+----------+----------------+| ä¹¦ç± | 4 || å®¶å±… | 14 || æ•°ç  | 8 || æœè£… | 15 || é›¶é£Ÿ | 9 |+----------+----------------+5 rows in set (0.0003 sec) ä½¿ç”¨HAVINGå¯¹åˆ†ç»„ä¹‹åçš„ç»“æœå†è¿‡æ»¤æ¯”å¦‚æˆ‘è¦åˆ—å‡ºä¸ªæ•°å°äº10çš„å•†å“ï¼Œçœ‹çœ‹æˆ‘å•†åŸç½‘ç«™ä¸Šè¿˜æœ‰å“ªäº›å•†å“æ¯”è¾ƒç¼º select category,count(category) as category_count from products group by category having category_count 10; è¿™æ ·å°±åªä¼šè¾“å‡ºå•†å“ç±»åˆ«å°äº10çš„å•†å“ç§ç±» +----------+----------------+| category | category_count |+----------+----------------+| ä¹¦ç± | 4 || æ•°ç  | 8 || é›¶é£Ÿ | 9 |+----------+----------------+3 rows in set (0.0042 sec) HAVINGå’ŒWHEREçš„åŒºåˆ«ï¼ŸWHEREï¼šåœ¨åˆ†ç»„ä¹‹å‰è¿‡æ»¤ã€‚æ¯”å¦‚ï¼šæˆ‘åªç»Ÿè®¡â€œå·²æ”¯ä»˜â€è®¢å•çš„é‡‘é¢ã€‚ HAVINGï¼šåœ¨åˆ†ç»„ä¹‹åè¿‡æ»¤ç»Ÿè®¡ç»“æœã€‚æ¯”å¦‚ï¼šæˆ‘åªçœ‹â€œæ¶ˆè´¹æ€»é¢è¶…è¿‡1000å…ƒâ€çš„å¤§å®¢æˆ·ã€‚ ä¸Šé¢é‚£ä¸ªæŒ‡ä»¤ï¼Œå¦‚æœæŠŠhavingç§»åŠ¨åˆ°whereä½œä¸ºæ¡ä»¶å°±ä¼š select category,count(category) as category_count from products where category_count 10 group by category ; æŠ¥é”™ ERROR: 1054 (42S22): Unknown column category_count in where clause WHEREä¼šæ‰¾ä¸åˆ°åˆ†ç»„åçš„è¿™ä¸€ä¸ªåˆ— å¤šè¡¨æŸ¥è¯¢åœ¨é‚£ä¸ªpyç”Ÿæˆçš„æ•°æ®åº“é‡Œï¼Œä¸ºäº†ä¸è®©æ•°æ®å†—ä½™ï¼Œæˆ‘æŠŠæ•°æ®æ‹†åˆ†åˆ°äº†ä¸åŒçš„è¡¨é‡Œï¼ˆç”¨æˆ·ä¸€å¼ è¡¨ã€è®¢å•ä¸€å¼ è¡¨ï¼‰ã€‚å¤šè¡¨æŸ¥è¯¢å°±æ˜¯é€šè¿‡ä¸€ä¸ª â€œå…³è”å­—æ®µâ€ï¼ŒæŠŠè¿™äº›è¡¨åƒæ‹¼å›¾ä¸€æ ·ä¸´æ—¶æ‹¼èµ·æ¥ã€‚å°±æ˜¯å¤šè¡¨æŸ¥è¯¢ ä½¿ç”¨JOINè¿›è¡Œå¤šè¡¨æŸ¥è¯¢åœ¨ MySQL ä¸­ï¼Œæœ€å¸¸ç”¨çš„å¤šè¡¨æŸ¥è¯¢æ–¹å¼æ˜¯ JOINã€‚ æŸ¥è¯¢ç±»å‹ åå­— æ•ˆæœ ä¸šåŠ¡åœºæ™¯ INNER JOIN å†…è¿æ¥ åªæ˜¾ç¤ºä¸¤è¾¹éƒ½èƒ½å¯¹ä¸Šçš„æ•°æ® æŸ¥å‡ºé‚£äº›â€œç¡®å®ä¸‹è¿‡å•â€çš„ç”¨æˆ·å’Œè®¢å• LEFT JOIN å·¦è¿æ¥ å·¦è¡¨å…¨ä¿ç•™ï¼Œå³è¡¨æ²¡å¯¹ä¸Šçš„æ˜¾ç¤º NULL æŸ¥å‡ºâ€œæ‰€æœ‰ç”¨æˆ·â€ï¼ŒåŒ…æ‹¬é‚£äº›è¿˜æ²¡ä¹°è¿‡ä¸œè¥¿çš„ RIGHT JOIN å³è¿æ¥ å³è¡¨å…¨ä¿ç•™ï¼ˆå¾ˆå°‘ç”¨ï¼Œé€šå¸¸ç”¨ LEFT JOIN ä»£æ›¿ï¼‰ - ä½¿ç”¨å†…è¿æ¥æ¯”å¦‚æˆ‘è¦æ‰¾åˆ°æ¯ä¸ªè®¢å•çš„ä¹°å®¶å’Œä¹°å®¶çš„æ‰‹æœºå· select users.username,users.phone,orders.order_no,orders.total_amount from users inner join orders on users.id = orders.user_id order by users.username; ä¹Ÿå¯ä»¥ä½¿ç”¨ASæ¥æ–¹ä¾¿å†™sqlè¯­å¥ï¼Œä¸¤è€…æ‰§è¡Œç»“æœæ˜¯ä¸€æ ·çš„ã€‚æˆ‘åŠ äº†ORDER BYæ¥ç”¨åå­—æ’åº SELECT u.username, u.phone, o.order_no, o.total_amountFROM users AS u INNER JOIN orders AS o ON u.id = o.user_idORDER BY u.username; è¿™æ ·å°±ä¼šè¾“å‡º +----------+-------------+------------------+--------------+| username | phone | order_no | total_amount |+----------+-------------+------------------+--------------+| ä¸å® | 13473076571 | ORD2025092300097 | 13104.00 || ä¸å® | 13473076571 | ORD2025040100039 | 8057.00 || ä¸å® | 13473076571 | ORD2025040800086 | 129.00 || ä½•å® | 14796476245 | ORD2025030500020 | 13788.00 |....çœç•¥è‹¥å¹² ä½¿ç”¨å·¦è¿æ¥æ¯”å¦‚æˆ‘è¦æä¸€ä¸ªå¯Œè±ªæ¦œï¼ŒæŒ‰ç…§æ¶ˆè´¹é¢åº¦å¤§å°æä¸€ä¸ªä¸æ¼æ‰æ²¡æœ‰ä¸‹è¿‡å•çš„äººçš„å…¨æ’åã€‚ ä½¿ç”¨ä¸‹é¢çš„sqlè¯­å¥ SELECT u.username, SUM(o.total_amount) as moneyFROM users AS uLEFT JOIN orders AS o ON u.id = o.user_idORDER BY money DESC; è¿™æ ·æ‰§è¡Œå°±ä¼šæŠ¥é”™ ERROR: 1140 (42000): In aggregated query without GROUP BY, expression #1 of SELECT list contains nonaggregated column mall_db_simple.u.username; this is incompatible with sql_mode=only_full_group_by æŠ¥é”™ä¿¡æ¯é‡Œçš„ only_full_group_by å°±æ˜¯ï¼šâ€œæ—¢ç„¶ä½ ç”¨äº†èšåˆå‡½æ•°ï¼Œé‚£ä½ å¿…é¡»å‘Šè¯‰æˆ‘ï¼Œé‚£äº›æ²¡è¢«èšåˆçš„å­—æ®µè¯¥æŒ‰ä»€ä¹ˆè§„åˆ™æ’åˆ—ï¼Ÿâ€ u.usernameï¼šè¿™ä¸ªå­—æ®µï¼Œå®ƒæƒ³æŠŠè¡¨é‡Œæ‰€æœ‰çš„ç”¨æˆ·åéƒ½åˆ—å‡ºæ¥ï¼ˆå‡è®¾æœ‰ 100 è¡Œï¼‰ã€‚ SUM(o.total_amount)ï¼šè¿™æ˜¯ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œå®ƒçš„ç›®çš„æ˜¯æŠŠæ‰€æœ‰çš„é’±åŠ èµ·æ¥ï¼Œåªåå‡ºä¸€ä¸ªå€¼ï¼ˆ1 è¡Œï¼‰ã€‚ è®©æ•°æ®åº“åœ¨ç¬¬ä¸€åˆ—æ˜¾ç¤º 100 ä¸ªåå­—ï¼Œä½†åœ¨ç¬¬äºŒåˆ—åªæ˜¾ç¤º 1 ä¸ªæ€»é‡‘é¢ã€‚ é‚£è¿™ 1 ä¸ªæ€»é‡‘é¢ï¼Œåˆ°åº•æ˜¯å¯¹é½ç¬¬ä¸€ä¸ªäººï¼Ÿè¿˜æ˜¯æœ€åä¸€ä¸ªäººï¼Ÿè¿˜æ˜¯å¹³å‡åˆ†ç»™æ‰€æœ‰äººï¼Ÿæ•°æ®åº“æ²¡æ³•å¯¹é½ ä½¿ç”¨ GROUP BY æ¥æŒ‰äººåˆ†ç»„ï¼Œç®—å‡ºæ¯ä¸ªäººçš„é‡‘é¢ SELECT u.username, SUM(o.total_amount) as moneyFROM users AS uLEFT JOIN orders AS o ON u.id = o.user_idGROUP BY u.usernameORDER BY money DESC; è¿™æ ·å°±èƒ½æ­£å¸¸è¾“å‡º +----------+----------+| username | money |+----------+----------+| èƒ¡ç‰ | 22626.00 || å‘¨é¾™ | 21825.00 || ä¸å® | 21290.00 |...çœç•¥è‹¥å¹²è¡Œ...| å‰æ¡‚èŠ | NULL || è‰¾é™ | NULL || ç¨‹å¸… | NULL |+----------+----------+193 rows in set (0.0031 sec) æ²¡ä¸‹è¿‡å•çš„moneyåˆ—å°±ä¼šæ˜¯NULLï¼Œæˆ‘æƒ³æŠŠå®ƒæ”¹æˆ0ï¼Œä½¿ç”¨IFNULLå‡½æ•° SELECT u.username, IFNULL(SUM(o.total_amount),0) as moneyFROM users AS uLEFT JOIN orders AS o ON u.id = o.user_idGROUP BY u.usernameORDER BY money DESC; è¿™æ ·çœ‹ç€å°±èˆ’æœå¤šäº† +----------+----------+| username | money |+----------+----------+| èƒ¡ç‰ | 22626.00 || å‘¨é¾™ | 21825.00 || ä¸å® | 21290.00 |...çœç•¥è‹¥å¹²è¡Œ...| å‰æ¡‚èŠ | 0.00 || è‰¾é™ | 0.00 || ç¨‹å¸… | 0.00 |+----------+----------+193 rows in set (0.0023 sec) ä½¿ç”¨å­æŸ¥è¯¢è¿›è¡Œå¤šè¡¨æŸ¥è¯¢å…ˆæŸ¥å‡ºä¸€ä¸ªç»“æœï¼Œå†æŠŠè¿™ä¸ªç»“æœä½œä¸ºæ¡ä»¶ä¼ ç»™ä¸‹ä¸€ä¸ªæŸ¥è¯¢ æ¯”å¦‚æˆ‘æƒ³æ‰¾å‡ºé‚£ä¸ªå•ç¬”è®¢å•èŠ±äº†æœ€å¤šé’±çš„ç”¨æˆ·ï¼Œå°±æ˜¯åˆ†æˆä¸¤ä¸ªæŸ¥è¯¢ 1.ordersè¡¨é‡Œæ‰¾åˆ°å•ç¬”é‡‘é¢æœ€å¤§çš„userid 2.æ ¹æ®æ‰¾åˆ°çš„useridåœ¨usersè¡¨é‡Œæ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯ SELECT * FROM users WHERE id = (SELECT user_id FROM orders ORDER BY total_amount DESC LIMIT 1); è¿™æ ·å°±èƒ½è¾“å‡º +-----+----------+-----------------+-------------+--------+---------------------+| id | username | email | phone | city | created_at |+-----+----------+-----------------+-------------+--------+---------------------+| 100 | å‘¨é¾™ | vyu@example.net | 18958822331 | é˜œæ–°å¿ | 2001-07-10 10:29:42 |+-----+----------+-----------------+-------------+--------+---------------------+1 row in set (0.0005 sec) å¦‚æœè¦æŠŠä¸Šé¢çš„å¯Œè±ªæ¦œæ”¹æˆå­æŸ¥è¯¢ SELECT u.username, (SELECT IFNULL(SUM(orders.total_amount), 0) FROM orders WHERE orders.user_id = u.id) AS moneyFROM users AS u ORDER BY money DESC; æ•ˆæœæ˜¯ä¸€æ ·çš„ ç´¢å¼•å¦‚æœæŠŠæ•°æ®åº“æ¯”ä½œä¸€æœ¬ã€Šæ–°åå­—å…¸ã€‹ï¼Œé‚£â€œç´¢å¼•â€å°±æ˜¯å­—å…¸å‰é¢çš„æ‹¼éŸ³æ£€ç´¢è¡¨ã€‚ æ²¡ç´¢å¼•ï¼ˆå…¨è¡¨æ‰«æ Full Table Scanï¼‰ï¼šå‡è®¾è¦æŸ¥â€œå­—â€è¿™ä¸ªå­—ï¼Œä½†å­—å…¸æ²¡æœ‰ç›®å½•ã€‚ä½ åªèƒ½ä»ç¬¬ä¸€é¡µå¼€å§‹ï¼Œä¸€é¡µä¸€é¡µå¾€åç¿»ï¼Œç›´åˆ°ç¿»åˆ°ä¸ºæ­¢ã€‚å¦‚æœå­—å…¸æœ‰ 1000 é¡µï¼Œæœ€åæƒ…å†µä½ è¦ç¿» 1000 æ¬¡ã€‚ æ•ˆç‡ï¼šæä½ O(n)ã€‚ æœ‰ç´¢å¼•ï¼ˆIndexï¼‰ï¼šå…ˆçœ‹å‰é¢çš„æ‹¼éŸ³ç›®å½•ï¼Œæ‰¾åˆ° zi åœ¨ç¬¬ 500 é¡µã€‚ç›´æ¥ç¿»åˆ°ç¬¬ 500 é¡µã€‚ æ•ˆç‡ï¼šæé«˜ O(log n)ï¼ˆå› ä¸º MySQL åº•å±‚ç”¨çš„æ˜¯ B+æ ‘ ç»“æ„ï¼Œç±»ä¼¼äºŒåˆ†æŸ¥æ‰¾ï¼‰ã€‚æ ¸å¿ƒä½œç”¨ï¼šä»¥ç©ºé—´æ¢æ—¶é—´ã€‚ç´¢å¼•æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ï¼Œå ç”¨ç¡¬ç›˜ç©ºé—´ï¼Œä½†èƒ½è®©æŸ¥è¯¢é€Ÿåº¦æå‡ç™¾å€åƒå€ã€‚ å…¶å®é‚£ä¸ªpythonåœ¨åˆ›å»ºæ•°æ®è¡¨çš„æ—¶å€™ï¼Œæ¯ä¸ªè¡¨åˆ›å»ºäº†ä¸€ä¸ªä¸»é”®ã€‚ MySQL localhost:3306 mall_db_simple SQL show index from users;+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+| Table | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment |+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+| users | 0 | PRIMARY | 1 | id | A | 2000000 | NULL | NULL | | BTREE | | |+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+1 row in set (0.0011 sec) è€Œä¸»é”®æ˜¯è¢«Mysqlé»˜è®¤ä½œä¸ºä¸€ä¸ªç´¢å¼• ä¸»é”®ç´¢å¼•æœ‰ä»€ä¹ˆç”¨ï¼Ÿå®šä½ä¸€è¡Œæ•°æ®æ¯”å¦‚è¿™æ ·çš„ä¸€æ¡sql SELECT * FROM orders WHERE id = 10086; è¿™ä¸æ˜¯â€œæŸ¥æ¡ä»¶â€ï¼Œæ˜¯â€œæˆ‘çŸ¥é“ä½ æ˜¯è°ï¼Œç›´æ¥æŠŠä½ æ‹å‡ºæ¥â€ã€‚ ä¸æ‰«è¡¨ï¼Œä¸æ¯”å¯¹ï¼Œç›´æ¥åœ¨ B+Tree ä¸Šç²¾å‡†å®šä½ å¤æ‚åº¦æ˜¯ O(log n)ï¼Œè€Œä¸æ˜¯ O(n)ã€‚ å†³å®šæ•°æ®åœ¨ç£ç›˜ä¸Šçš„ç‰©ç†é¡ºåºåœ¨ InnoDB é‡Œï¼Œè¡¨ä¸­çš„æ¯ä¸€è¡Œï¼Œæ˜¯æŒ‰ä¸»é”®é¡ºåºæ’åœ¨ä¸€èµ·å­˜çš„ id INT AUTO_INCREMENT PRIMARY KEY æ„å‘³ç€ï¼Œid å°çš„åœ¨å‰ï¼Œid å¤§çš„åœ¨åï¼Œæ•°æ®é¡µé¡ºç€æ’ å¦‚æœè¦æ‰§è¡Œè¿™æ ·çš„æŸ¥è¯¢ SELECT * FROM orders WHERE id BETWEEN 100 AND 200; æ•°æ®å°±åœ¨ç£ç›˜ä¸Šè¿ç€ï¼Œä¸€é¡µä¸€é¡µé¡ºç€å°±è¯»ä¸‹å»äº† å¹¶ä¸”è¿™æ ·joinçš„ä¹Ÿå¿«ï¼Œåªè¦ join çš„æ˜¯ä¸»é”® æ™®é€šç´¢å¼•çš„â€œæœ€ç»ˆè½è„šç‚¹â€åœ¨ InnoDB é‡Œï¼šæ™®é€šç´¢å¼• â‰  æŒ‡å‘è¡Œæ•°æ®ï¼Œè€Œæ˜¯æ™®é€šç´¢å¼• â†’ æŒ‡å‘ä¸»é”® æ™®é€šç´¢å¼•èŠ‚ç‚¹é‡Œå­˜çš„æ˜¯ï¼šç´¢å¼•å€¼ + ä¸»é”®å€¼ å›è¡¨ï¼Ÿä»€ä¹ˆæ˜¯å›è¡¨æ¯”å¦‚æœ‰è¿™ä¹ˆä¸€å¼ è¡¨ users( id INT PRIMARY KEY, username VARCHAR(50), email VARCHAR(50), balance DECIMAL)INDEX idx_email(email) æ‰§è¡Œè¿™æ ·çš„æŸ¥è¯¢ SELECT * FROM users WHERE email = a@b.com; å®é™…åœ¨Mysqlé‡Œæ˜¯è¿™æ ·çš„ï¼š å…ˆåœ¨idx_emailé‡Œï¼Œæ ¹æ® a@b.com æ‰¾åˆ° id=100è¿™é‡Œåªæœ‰emailå’Œidï¼Œæ²¡æœ‰balanceå’Œusername ç„¶åå†ç”¨idæ‰¾åˆ°è¿™ä¸€è¡Œçš„æ•°æ®ï¼Œè¿™ä¸€æ­¥å°±æ˜¯å›è¡¨ ä»æ™®é€šç´¢å¼• â†’ å›åˆ°ä¸»é”®ç´¢å¼• â†’ æ‹¿æ•´è¡Œæ•°æ® ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”Ÿå›è¡¨åƒè¿™æ · SELECT * FROM users WHERE email = a@b.com; ç”¨äº†æ™®é€šç´¢å¼•ï¼Œä½†æ˜¯è¦åˆ—é‡Œæ‰€æœ‰æ•°æ®ï¼Œç´¢å¼•é‡Œæ²¡æœ‰è¿™ä¹ˆå¤šåˆ—å°±ä¼šå›è¡¨ ä½†æ˜¯å¦‚æœæ˜¯è¿™æ · SELECT email FROM users WHERE email = a@b.com;æˆ–è€…SELECT email, id FROM users WHERE email = a@b.com; è¿™æ ·å°±ä¸ä¼šå›è¡¨ï¼Œå› ä¸ºè¦æ‰¾çš„ä¸œè¥¿åœ¨ç´¢å¼•é‡Œå°±æœ‰äº† ç´¢å¼•çš„ä½¿ç”¨è¿˜æ˜¯é‚£ä¸ªpyï¼ŒæŠŠç”¨æˆ·æ”¹æˆä¸¤ç™¾ä¸‡ä¸ªï¼Œè¿è¡ŒPyåæ‰§è¡Œä¸‹é¢çš„æŸ¥è¯¢ SELECT * FROM users WHERE username LIKE å“ˆåŸº; è¿è¡Œåæ˜¯æ‰¾ä¸åˆ°è¿™ä¸ªæ•°æ®çš„ï¼Œè¿™ä¸ªæ­£å¸¸ï¼Œä¸»è¦çœ‹æ‰¾æ•°æ®èŠ±äº†å¤šä¹…ï¼Ÿ MySQL localhost:3306 mall_db_simple SQL SELECT * FROM users WHERE username LIKE å“ˆåŸº;Empty set (0.2233 sec) 0.22ç§’ï¼Œçœ‹èµ·æ¥ä¸å¤šï¼Œçº¯ç²¹æ˜¯å› ä¸ºæˆ‘çš„ç”µè„‘ç¡¬ä»¶ï¼ˆCPUã€å†…å­˜ã€SSDï¼‰å¤ªå¼ºäº†ï¼ŒæŠŠâ€œç¬¨é‡â€çš„ SQL ç¡¬æ‰›ä¸‹æ¥äº†ã€‚å¦‚æœæ˜¯è¦é¢å¯¹å¤§é‡å¹¶å‘æŸ¥è¯¢ï¼Œæ¯æ¬¡å…¨è¡¨æ‰«æå°±å¤ªæ…¢äº† users è¡¨é‡Œç°åœ¨åªæœ‰ä¸»é”®ç´¢å¼•ï¼ˆPRIMARYï¼‰ï¼Œä½†æŸ¥è¯¢æ¡ä»¶æ˜¯ WHERE username LIKE ...ã€‚å› ä¸º username æ²¡æœ‰ç´¢å¼•ï¼ŒMySQL å…¶å®åšäº†ä¸€æ¬¡â€œå…¨è¡¨æ‰«æâ€ã€‚ æ‰§è¡Œä¸‹é¢çš„SQLçœ‹çœ‹æ˜¯æ€ä¹ˆæŸ¥è¯¢çš„ EXPLAIN SELECT * FROM users WHERE username LIKE å“ˆåŸº; è¿è¡Œè¾“å‡º: +----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------------+| 1 | SIMPLE | users | NULL | ALL | NULL | NULL | NULL | NULL | 2000000 | 11.11 | Using where |+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------------+1 row in set, 1 warning (0.0010 sec)Note (code 1003): /* select#1 */ select `mall_db_simple`.`users`.`id` AS `id`,`mall_db_simple`.`users`.`username` AS `username`,`mall_db_simple`.`users`.`email` AS `email`,`mall_db_simple`.`users`.`phone` AS `phone`,`mall_db_simple`.`users`.`city` AS `city`,`mall_db_simple`.`users`.`created_at` AS `created_at` from `mall_db_simple`.`users` where (`mall_db_simple`.`users`.`username` like å“ˆåŸº) å¯ä»¥çœ‹åˆ°typeåˆ—æ˜¯ALL(ä»£è¡¨å…¨è¡¨æ‰«æï¼Œæœ€çƒ‚çš„æƒ…å†µ) ï¼Œrowsåˆ—æ˜¯2000000éå†äº†ä¸¤ç™¾ä¸‡è¡Œ åˆ›å»ºå’Œä½¿ç”¨ç´¢å¼•åˆ›å»ºç´¢å¼•çš„SQLè¯­å¥æ˜¯ CREATE INDEX ç´¢å¼•å ON è¡¨å(å­—æ®µå); åœ¨è¿™é‡Œå°±æ˜¯ CREATE INDEX idx_username ON users(username); æ‰§è¡Œåå†æ¬¡è¿è¡Œä¸Šé¢é‚£ä¸ªæŸ¥è¯¢ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ç¬é—´ç»™å‡ºç»“æœäº† MySQL localhost:3306 mall_db_simple SQL SELECT * FROM users WHERE username LIKE å“ˆåŸº;Empty set (0.0004 sec) åªç”¨äº†0.0004ç§’ï¼Œç°åœ¨å†çœ‹çœ‹Mysqlæ˜¯æ€ä¹ˆæŸ¥è¯¢çš„ MySQL localhost:3306 mall_db_simple SQL EXPLAIN SELECT * FROM users WHERE username LIKE å“ˆåŸº;+----+-------------+-------+------------+-------+---------------+--------------+---------+------+------+----------+-----------------------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |+----+-------------+-------+------------+-------+---------------+--------------+---------+------+------+----------+-----------------------+| 1 | SIMPLE | users | NULL | range | idx_username | idx_username | 203 | NULL | 1 | 100 | Using index condition |+----+-------------+-------+------------+-------+---------------+--------------+---------+------+------+----------+-----------------------+1 row in set, 1 warning (0.0004 sec)Note (code 1003): /* select#1 */ select `mall_db_simple`.`users`.`id` AS `id`,`mall_db_simple`.`users`.`username` AS `username`,`mall_db_simple`.`users`.`email` AS `email`,`mall_db_simple`.`users`.`phone` AS `phone`,`mall_db_simple`.`users`.`city` AS `city`,`mall_db_simple`.`users`.`created_at` AS `created_at` from `mall_db_simple`.`users` where (`mall_db_simple`.`users`.`username` like å“ˆåŸº) çœ‹rowsåˆ—å˜æˆäº†1ï¼Œå°±æ˜¯è¯´æ˜åªéœ€è¦æ‰« 1 æ¡ç´¢å¼•è®°å½•ï¼Œå°±èƒ½å‘½ä¸­ åˆ é™¤ç´¢å¼•DROP INDEX ç´¢å¼•å ON è¡¨å; å¦‚æœç´¢å¼•å»ºé”™äº†ï¼Œæˆ–è€…æ²¡ç”¨ä¸Šï¼Œè¦åˆ æ‰ï¼ˆå› ä¸ºç´¢å¼•ä¼šæ‹–æ…¢å†™å…¥é€Ÿåº¦ï¼‰ã€‚å°±ç”¨ä¸Šé¢çš„å‘½ä»¤ã€‚æˆ‘ä¸æ¼”ç¤ºäº† ç´¢å¼•çš„å‰¯ä½œç”¨æ—¢ç„¶è¿™ä¹ˆå¥½ï¼Œä¸ºå•¥ä¸ç»™æ‰€æœ‰å­—æ®µéƒ½åŠ ï¼Ÿç»™ username, phone, email, address å…¨åŠ ä¸Šç´¢å¼•ï¼Œå²‚ä¸æ˜¯èµ·é£ï¼Ÿ æ‹–æ…¢å†™å…¥ï¼ˆINSERTUPDATEDELETEï¼‰ï¼š å¾€ä¹¦é‡Œå†™ä¸€è¡Œå†…å®¹ï¼ˆINSERTï¼‰ï¼Œä¸ä»…è¦å¾€æ­£æ–‡é‡Œå†™ï¼Œè¿˜å¾—å»æ”¹ç›®å½•ï¼ˆç»´æŠ¤ç´¢å¼•æ ‘ï¼‰ã€‚ç´¢å¼•è¶Šå¤šï¼Œæ”¹ç›®å½•è¶Šæ…¢ã€‚ å¯¹äºå†™å¤šè¯»å°‘çš„ç³»ç»Ÿï¼ˆæ¯”å¦‚æ—¥å¿—ç³»ç»Ÿï¼‰ï¼Œç´¢å¼•è¦æ…ç”¨ã€‚ å ç”¨ç£ç›˜ç©ºé—´ï¼š ç´¢å¼•ä¹Ÿæ˜¯æ–‡ä»¶ï¼Œä¹Ÿæ˜¯è¦å­˜ç¡¬ç›˜çš„ã€‚æ•°æ®é‡å¤§æ—¶ï¼Œç´¢å¼•å¯èƒ½æ¯”æ•°æ®æœ¬èº«è¿˜å¤§ã€‚ LIKEçš„å‘åœ¨åˆšåˆšçš„SQLé‡Œä½¿ç”¨äº†LIKEä½†æ˜¯æ²¡æœ‰åŠ ç™¾åˆ†å·ã€‚ä¹Ÿå°±æ˜¯è¯´å…¶å®è¿˜æ˜¯ä½¿ç”¨çš„ç²¾ç¡®åŒ¹é… ç²¾ç¡®åŒ¹é…å‰ç¼€åŒ¹é…ï¼ˆç´¢å¼•ç”Ÿæ•ˆ ï¼‰ EXPLAIN SELECT * FROM users WHERE username LIKE å“ˆåŸº%; ç»“æœï¼štype æ˜¯ range æˆ– refã€‚ç´¢å¼•ç”Ÿæ•ˆäº†ï¼å› ä¸ºç›®å½•æ˜¯æŒ‰æ‹¼éŸ³æ’çš„ï¼ŒMySQL çŸ¥é“â€œå“ˆâ€åœ¨å‰é¢çš„å‡ é¡µã€‚ +----+-------------+-------+------------+-------+---------------+--------------+---------+------+------+----------+-----------------------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |+----+-------------+-------+------------+-------+---------------+--------------+---------+------+------+----------+-----------------------+| 1 | SIMPLE | users | NULL | range | idx_username | idx_username | 203 | NULL | 1 | 100 | Using index condition |+----+-------------+-------+------------+-------+---------------+--------------+---------+------+------+----------+-----------------------+1 row in set, 1 warning (0.0009 sec)Note (code 1003): /* select#1 */ select `mall_db_simple`.`users`.`id` AS `id`,`mall_db_simple`.`users`.`username` AS `username`,`mall_db_simple`.`users`.`email` AS `email`,`mall_db_simple`.`users`.`phone` AS `phone`,`mall_db_simple`.`users`.`city` AS `city`,`mall_db_simple`.`users`.`created_at` AS `created_at` from `mall_db_simple`.`users` where (`mall_db_simple`.`users`.`username` like å“ˆåŸº%) å·¦æ¨¡ç³ŠåŒ¹é…ï¼ˆç´¢å¼•å¤±æ•ˆ ï¼‰ -- æ‰¾åå­—é‡Œä»¥â€œç±³â€ç»“å°¾çš„äººï¼ˆæ¯”å¦‚å“ˆåŸºç±³ã€å°ç±³ï¼‰EXPLAIN SELECT * FROM users WHERE username LIKE %ç±³; ç»“æœï¼štype åˆæ˜¯ ALL äº†ï¼ æŸ¥å­—å…¸çš„æ—¶å€™ï¼Œå¦‚æœåªçŸ¥é“è¿™å°±å­—â€œç»“å°¾æ˜¯ç±³â€ï¼Œæ²¡æ³•ç”¨æ‹¼éŸ³ç›®å½•æŸ¥ï¼Œåªèƒ½æŠŠæ•´æœ¬å­—å…¸ç¿»ä¸€éã€‚ +----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------------+| 1 | SIMPLE | users | NULL | ALL | NULL | NULL | NULL | NULL | 2000000 | 11.11 | Using where |+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------------+1 row in set, 1 warning (0.0003 sec)Note (code 1003): /* select#1 */ select `mall_db_simple`.`users`.`id` AS `id`,`mall_db_simple`.`users`.`username` AS `username`,`mall_db_simple`.`users`.`email` AS `email`,`mall_db_simple`.`users`.`phone` AS `phone`,`mall_db_simple`.`users`.`city` AS `city`,`mall_db_simple`.`users`.`created_at` AS `created_at` from `mall_db_simple`.`users` where (`mall_db_simple`.`users`.`username` like %ç±³) å¦‚æœæˆ‘æƒ³å€’ç€æŸ¥ä¹Ÿèƒ½ç¬é—´ç»™å‡ºç»“æœï¼Ÿä½¿ç”¨è™šæ‹Ÿåˆ—åŠŸèƒ½ -- 1. ç»™è¡¨åŠ ä¸€ä¸ªè™šæ‹Ÿåˆ—ï¼Œå†…å®¹æ˜¯ username çš„å€’åºALTER TABLE users ADD reverse_username VARCHAR(50) GENERATED ALWAYS AS (REVERSE(username));-- 2. ç»™è¿™ä¸ªå€’åºåˆ—åŠ ç´¢å¼•CREATE INDEX idx_reverse_username ON users(reverse_username); å¦‚æœä½¿ç”¨çš„æ˜¯Windowsçš„phpstudyä¸­çš„Mysql5.7ï¼Œé»˜è®¤ä¸ä¼šæ˜¯InnoDBï¼Œåœ¨æ‰§è¡Œç¬¬äºŒæ­¥å°±ä¼šæŠ¥é”™ ERROR: 1478 (HY000): Table storage engine MyISAM does not support the create option Index on virtual generated column è¿™æ—¶å€™ä½¿ç”¨ALTERå‘½ä»¤ä¿®æ”¹å­˜å‚¨å¼•æ“ä¸ºInnoDB ALTER TABLE users ENGINE=InnoDB; å†æ‰§è¡Œç¬¬äºŒæ­¥å°±æ­£å¸¸äº†ï¼Œç°åœ¨çœ‹çœ‹å·¦æ¨¡ç³ŠåŒ¹é…æ•ˆæœï¼Œä¸è¿‡å¾—åœ¨usernameçš„å€’åºåˆ—é‡ŒæŸ¥æ‰¾ MySQL localhost:3306 mall_db_simple SQL SELECT * FROM users WHERE reverse_username LIKE ç±³%;Empty set (0.0015 sec)MySQL localhost:3306 mall_db_simple SQL EXPLAIN SELECT * FROM users WHERE reverse_username LIKE ç±³%;+----+-------------+-------+------------+-------+----------------------+----------------------+---------+------+------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |+----+-------------+-------+------------+-------+----------------------+----------------------+---------+------+------+----------+-------------+| 1 | SIMPLE | users | NULL | range | idx_reverse_username | idx_reverse_username | 203 | NULL | 1 | 100 | Using where |+----+-------------+-------+------------+-------+----------------------+----------------------+---------+------+------+----------+-------------+1 row in set, 1 warning (0.0008 sec)Note (code 1003): /* select#1 */ select `mall_db_simple`.`users`.`id` AS `id`,`mall_db_simple`.`users`.`username` AS `username`,`mall_db_simple`.`users`.`email` AS `email`,`mall_db_simple`.`users`.`phone` AS `phone`,`mall_db_simple`.`users`.`city` AS `city`,`mall_db_simple`.`users`.`created_at` AS `created_at`,`mall_db_simple`.`users`.`reverse_username` AS `reverse_username` from `mall_db_simple`.`users` where (`mall_db_simple`.`users`.`reverse_username` like ç±³%) ä¹Ÿæ˜¯ç§’å‡ºã€‚ä¹Ÿåªç”¨æ‰«æä¸€æ¡è®°å½• äº‹åŠ¡äº‹åŠ¡æ˜¯ä¸æ”¯æŒMyISAMå­˜å‚¨å¼•æ“çš„ äº‹åŠ¡æ˜¯æŠŠä¸€ç»„SQLè¯­å¥æ‰“åŒ…æˆä¸€ä¸ªæ•´ä½“ï¼Œåœ¨è¿™ç»„SQLè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚è¿™ç»„SQLè¯­å¥å¯ä»¥æ˜¯ä¸€æ¡ä¹Ÿå¯ä»¥æ˜¯å¤šæ¡ã€‚ äº‹åŠ¡çš„å…«è‚¡: A (Atomicity) åŸå­æ€§ï¼š äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œå°±æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“ï¼ŒåƒåŸå­ä¸€æ ·ã€‚è¿™äº›æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚æ•°æ®åº“ä¼šè®°å½•äº‹åŠ¡æ‰§è¡Œå‰çš„æ•°æ®çŠ¶æ€ï¼Œä¸€æ—¦äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹å‡ºç°å¤±è´¥ï¼Œå°±ä¼šå›æ»šåˆ°åŸæ¥çš„åˆå§‹çŠ¶æ€ã€‚ åŸç†ï¼šé  Undo Log å®ç°ï¼ˆä¸‡ä¸€å¤±è´¥äº†ï¼Œæ ¹æ®æ—¥å¿—æŠŠæ•°æ®æ”¹å›å»ï¼‰ã€‚ C (Consistency) ä¸€è‡´æ€§ï¼š äº‹åŠ¡æ‰§è¡Œå‰åï¼Œäº‹åŠ¡çš„å®Œæ•´æ€§ä¸ä¼šè¢«ç ´åã€‚äº‹åŠ¡æ‰§è¡Œå®Œæˆä¹‹åï¼Œä¿è¯æ•°æ®æ­£ç¡®å¹¶ä¸”ç¬¦åˆé¢„æœŸã€‚ I (Isolation) éš”ç¦»æ€§ï¼š æ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹å’Œè¯»å†™ï¼Œéš”ç¦»æ€§å¯ä»¥ä¿è¯å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œï¼Œå¹¶ä¸”ä¸ç›¸äº’å¹²æ‰°ã€‚ åŸç†ï¼šé  é” (Lock) å’Œ MVCC (å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶) å®ç°ã€‚ D (Durability) æŒä¹…æ€§ï¼š åªè¦ COMMIT äº†ï¼Œå“ªæ€•ä¸‹ä¸€ç§’æœåŠ¡å™¨çˆ†ç‚¸ï¼Œç”µçº¿è¢«æŒ–æ–­ï¼Œæ•°æ®ä¹Ÿä¸èƒ½ä¸¢ã€‚ åŸç†ï¼šé  Redo Log å®ç°ï¼ˆå…ˆå†™æ—¥å¿—å†å†™ç£ç›˜ï¼‰ã€‚ äº‹åŠ¡æŒ‡ä»¤ æŒ‡ä»¤ ä½œç”¨ START TRANSACTION (æˆ– BEGIN) å¼€å¯äº‹åŠ¡ã€‚å‘Šè¯‰ MySQLï¼šâ€œä»è¿™ä¸€è¡Œå¼€å§‹ï¼Œåé¢çš„æ“ä½œå…ˆåˆ«çœŸå†™å…¥ç¡¬ç›˜ï¼Œå…ˆè®°åœ¨å°æœ¬æœ¬ä¸Šã€‚â€ COMMIT æäº¤ã€‚å‘Šè¯‰ MySQLï¼šâ€œåˆšæ‰çš„æ“ä½œéƒ½ç¡®è®¤æ— è¯¯ï¼Œå…¨éƒ¨ç”Ÿæ•ˆï¼Œå†™å…¥ç¡¬ç›˜ï¼â€ ROLLBACK å›æ»šã€‚å‘Šè¯‰ MySQLï¼šâ€œå‡ºäº‹äº†ï¼åˆšæ‰çš„æ“ä½œå…¨éƒ¨ä½œåºŸï¼Œæ’¤é”€åˆ°å¼€å¯äº‹åŠ¡ä¹‹å‰çš„çŠ¶æ€ï¼â€ savepoint è®¾ç½®ä¸€ä¸ªå­˜æ¡£ã€‚å‘Šè¯‰Mysqlåœ¨è¿™é‡Œä¿å­˜ä¸€ä¸ªçŠ¶æ€ã€‚å¦‚æœå›æ»šçš„è¯å¯ä»¥é€‰æ‹©å›æ»šåˆ°è¿™é‡Œ æ³¨æ„ï¼šäº‹åŠ¡æ˜¯æœ‰é€‚ç”¨èŒƒå›´çš„ èƒ½å›æ»šçš„ï¼ˆDML - Data Manipulation Languageï¼‰ï¼š INSERTï¼ˆå¢ï¼‰ UPDATEï¼ˆæ”¹ï¼‰ DELETEï¼ˆåˆ æ•°æ®ï¼‰ ä¸èƒ½å›æ»šä¸”ä¼šå¼ºåˆ¶æäº¤çš„ï¼ˆDDL - Data Definition Languageï¼‰ï¼š CREATEï¼ˆå»ºè¡¨åº“ï¼‰ DROPï¼ˆåˆ è¡¨åº“ï¼‰ ALTERï¼ˆæ”¹å­—æ®µï¼‰ TRUNCATEï¼ˆæ¸…ç©ºè¡¨ï¼‰ æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­: MySQL localhost:3306 mall_db_simple SQL start transaction;Query OK, 0 rows affected (0.0001 sec)MySQL localhost:3306 mall_db_simple â˜… SQL show databases;+--------------------+| Database |+--------------------+| information_schema || mall_db_simple || mysql || performance_schema || sys |+--------------------+5 rows in set (0.0008 sec)MySQL localhost:3306 mall_db_simple â˜… SQL drop database mall_db_simple;Query OK, 4 rows affected (0.0082 sec)MySQL localhost:3306 mall_db_simple SQL rollback;Query OK, 0 rows affected (0.0002 sec)MySQL localhost:3306 mall_db_simple SQL show databases;+--------------------+| Database |+--------------------+| information_schema || mysql || performance_schema || sys |+--------------------+4 rows in set (0.0006 sec) Mysqlåœ¨æ‰§è¡ŒDDLæŒ‡ä»¤å‰ï¼Œä¸ä¼šç®¡å‰é¢æœ‰æ²¡æœ‰start transaction;éƒ½ä¼šå…ˆæ‰§è¡Œä¸€ä¸ªCOMMITï¼Œç„¶åå†ä¼šæ‰§è¡ŒDDLæŒ‡ä»¤ã€‚æ‰§è¡Œå®ŒDDLåå†ä¼šæ‰§è¡Œä¸€ä¸ªCOMMITã€‚åç»­çš„rollbackæ»šä¸å›æ¥ DELETEå’ŒTRUNCATEçš„åŒºåˆ« æƒ³æ¸…ç©ºä¸€å¼ è¡¨ï¼Œä¸”å¸Œæœ›å¯ä»¥å›æ»šï¼š ç”¨ DELETE FROM users; è¿™æ˜¯ DMLï¼Œé€Ÿåº¦æ…¢ï¼ˆä¸€è¡Œè¡Œåˆ ï¼‰ï¼Œä½†å¯ä»¥ ROLLBACKã€‚ æƒ³æ¸…ç©ºä¸€å¼ è¡¨ï¼Œä¸ç•™åè·¯ï¼š ç”¨ TRUNCATE TABLE users; è¿™æ˜¯ DDLï¼Œé€Ÿåº¦å¿«ï¼ˆç›´æ¥æŠŠè¡¨æ–‡ä»¶æ‰”äº†é‡æ–°å»ºä¸€ä¸ªï¼‰ï¼Œä½†ROLLBACKä¸å›æ¥ã€‚ å¼€å§‹äº‹åŠ¡ä¹‹å‰åº“å­˜æ˜¯æ€ä¹ˆè¢«ä¸‹å•æ“ä½œæä¹±çš„ï¼Ÿå…ˆçœ‹çœ‹idä¸º1çš„å•†å“æœ‰å¤šå°‘ä¸ªåº“å­˜ SELECT id, stock FROM products WHERE id = 1; æ‰§è¡Œå¾—åˆ°ç»“æœå‰©ä½™100ä¸ª MySQL localhost:3306 mall_db_simple SQL SELECT id, stock FROM products WHERE id = 1;+----+-------+| id | stock |+----+-------+| 1 | 100 |+----+-------+1 row in set (0.0003 sec) æ­¤æ—¶ä¸€ä½æ­£å¸¸ç”¨æˆ·è¿›æ¥ä¹°äº†ä¸€ä¸ªidä¸º1çš„å•†å“ UPDATE products SET stock = stock - 1 WHERE id = 1; è¿™æ—¶å€™åº“å­˜è¿˜å‰©99ä¸ª MySQL localhost:3306 mall_db_simple SQL SELECT id, stock FROM products WHERE id = 1;+----+-------+| id | stock |+----+-------+| 1 | 99 |+----+-------+1 row in set (0.0004 sec) sec) ç„¶åä¸€ä½æµ‹è¯•è¿›æ¥ä¹°äº†-1ä¸ªidä¸º1çš„å•†å“ UPDATE products SET stock = stock - (-1) WHERE id = 1; åº“å­˜å¢åŠ äº†ï¼ MySQL localhost:3306 mall_db_simple SQL UPDATE products SET stock = stock - (-1) WHERE id = 1;Query OK, 1 row affected (0.0010 sec)Rows matched: 1 Changed: 1 Warnings: 0MySQL localhost:3306 mall_db_simple SQL SELECT id, stock FROM products WHERE id = 1;+----+-------+| id | stock |+----+-------+| 1 | 100 |+----+-------+1 row in set (0.0004 sec) ç„¶åè¿™ä½æµ‹è¯•ä¹°äº†9999ä¸ªå•†å“ UPDATE products SET stock = stock - 9999 WHERE id = 1; ç„¶åä»–ä¹°åˆ°äº†9999ä¸ªå•†å“å¹¶ä¸”æŠŠåº“å­˜å¹²æˆè´Ÿæ•°äº†ï¼Œå•†åŸè¶…å–äº† MySQL localhost:3306 mall_db_simple SQL UPDATE products SET stock = stock - 9999 WHERE id = 1;Query OK, 1 row affected (0.0010 sec)Rows matched: 1 Changed: 1 Warnings: 0MySQL localhost:3306 mall_db_simple SQL SELECT id, stock FROM products WHERE id = 1;+----+-------+| id | stock |+----+-------+| 1 | -9899 |+----+-------+1 row in set (0.0004 sec) è§£å†³æ–¹æ³•åˆ©ç”¨UPDATE è¯­å¥çš„åŸå­æ€§ï¼ŒæŠŠâ€œåˆ¤æ–­â€é€»è¾‘ç›´æ¥å†™åœ¨ SQL é‡Œã€‚ UPDATE products SET stock = stock - è´­ä¹°æ•°é‡WHERE id = 1 AND stock = è´­ä¹°æ•°é‡; è¿™æ ·çš„æ‰§è¡Œæ•ˆæœæ˜¯ MySQL localhost:3306 mall_db_simple SQL UPDATE products SET stock = stock - 9999 WHERE id = 1 AND stock = 9999;Query OK, 0 rows affected (0.0009 sec)Rows matched: 0 Changed: 0 Warnings: 0MySQL localhost:3306 mall_db_simple SQL SELECT id, stock FROM products WHERE id = 1;+----+-------+| id | stock |+----+-------+| 1 | 100 |+----+-------+1 row in set (0.0003 sec) æ•ˆæœï¼š åº“å­˜å¤Ÿï¼šMySQL æ‰¾åˆ°è¿™è¡Œæ•°æ®ï¼Œä¸”æ¡ä»¶æ»¡è¶³ï¼Œæ‰§è¡Œæ‰£å‡ã€‚è¿”å› Rows matched: 1, Changed: 1ã€‚åç«¯çœ‹åˆ°å½±å“è¡Œæ•°ä¸º 1ï¼Œåˆ¤å®šè´­ä¹°æˆåŠŸã€‚ åº“å­˜ä¸å¤Ÿï¼ˆæ¯”å¦‚åº“å­˜æ˜¯ 100ï¼‰ï¼šMySQL æ‰«è¿™è¡Œæ•°æ®ï¼Œå‘ç° stock = 9991 ä¸æˆç«‹ã€‚ç›´æ¥æ”¾å¼ƒä¿®æ”¹ã€‚è¿”å› Rows matched: 0, Changed: 0ã€‚åç«¯çœ‹åˆ°å½±å“è¡Œæ•°ä¸º 0ï¼Œåˆ¤å®šåº“å­˜ä¸è¶³ï¼Œä¸‹å•å¤±è´¥ã€‚ åŒæ ·çš„æ–¹æ³•è§£å†³ä¹°äº†-1ä¸ªå•†å“å¯¼è‡´åº“å­˜å¢åŠ çš„é—®é¢˜ï¼Œå†æ·»åŠ ä¸€ä¸ªANDåˆ¤æ–­é€»è¾‘ UPDATE products SET stock = stock - è´­ä¹°æ•°é‡WHERE id = 1 AND stock = è´­ä¹°æ•°é‡AND è´­ä¹°æ•°é‡ 0; è¿™æ ·å½“è´­ä¹°æ•°é‡ä¸º-1çš„æ—¶å€™ MySQL localhost:3306 mall_db_simple SQL UPDATE products SET stock = stock - (-1) WHERE id = 1 AND stock = (-1) AND (-1) 0;Query OK, 0 rows affected (0.0010 sec)Rows matched: 0 Changed: 0 Warnings: 0MySQL localhost:3306 mall_db_simple SQL SELECT id, stock FROM products WHERE id = 1;+----+-------+| id | stock |+----+-------+| 1 | 100 |+----+-------+1 row in set (0.0004 sec) åŒæ ·ï¼Œ0è¡Œè¢«matchï¼Œ0è¡Œè¢«change æ²¡ç”¨çš„è§£å†³æ–¹æ³•åç«¯æ£€æµ‹åº“å­˜æ•°é‡æ˜¯å¦å……è¶³ï¼Œå†æ‰§è¡Œæ‰£åº“å­˜ï¼Ÿ å‡è®¾åº“å­˜åªæœ‰ 1 ä¸ªã€‚User Aå’ŒUser BåŒæ—¶ç‚¹å‡»è´­ä¹°ã€‚åç«¯ä»£ç ï¼ˆé”™è¯¯ç¤ºèŒƒï¼‰ï¼š # 1. å…ˆæŸ¥åº“å­˜current_stock = db.query(SELECT stock FROM products WHERE id=1)# 2. åˆ¤æ–­å……è¶³if current_stock 0: # 3. æ‰£åº“å­˜ db.exec(UPDATE products SET stock = stock - 1 WHERE id=1) return è´­ä¹°æˆåŠŸelse: return åº“å­˜ä¸è¶³ è¶…å–è¿‡ç¨‹ï¼š æ—¶åˆ» 0.01sï¼šA æŸ¥åº“å­˜ï¼Œæ˜¯ 1ã€‚ æ—¶åˆ» 0.01sï¼šB æŸ¥åº“å­˜ï¼Œä¹Ÿæ˜¯ 1ï¼ˆå› ä¸º A è¿˜æ²¡æ‰£å‘¢ï¼‰ã€‚ æ—¶åˆ» 0.02sï¼šA åˆ¤æ–­ 1 0ï¼Œé€šè¿‡ã€‚ æ—¶åˆ» 0.02sï¼šB åˆ¤æ–­ 1 0ï¼Œé€šè¿‡ã€‚ æ—¶åˆ» 0.03sï¼šA æ‰£å‡ï¼Œåº“å­˜å˜ 0ã€‚ æ—¶åˆ» 0.03sï¼šB æ‰£å‡ï¼Œåº“å­˜å˜ -1ã€‚ç»“æœï¼šå–å‡ºäº† 2 ä¸ªæ‰‹æœºï¼Œå®é™…ä¸Šä»“åº“åªæœ‰ 1 ä¸ªã€‚è¶…å–äº†ã€‚ å¦‚æœè¦æ±‚åº“å­˜ä¸èƒ½ä¸ºè´Ÿæ•°ï¼Ÿåœ¨MySQL 8.0.16+ä½¿ç”¨Checkçº¦æŸæ˜¯å¯è¡Œçš„ ALTER TABLE productsADD CONSTRAINT chk_stock_non_negativeCHECK (stock = 0); ä¹‹åå†å°è¯•æ‰£é™¤è¶…è¿‡åº“å­˜çš„æ•°çš„æ—¶å€™ UPDATE products SET stock = stock - 9999 WHERE id = 1; å°±ä¼šç›´æ¥æŠ¥é”™ ERROR 3819 (HY000): Check constraint chk_stock_non_negative is violated ä½†æ˜¯è¦æ³¨æ„ï¼ŒCHECK æ˜¯å…œåº•ï¼Œä¸æ˜¯ä¸»æµç¨‹ã€‚å› ä¸ºæŠ¥é”™æˆæœ¬é«˜ï¼Œä¸æ–¹ä¾¿åŒºåˆ†â€œåº“å­˜ä¸è¶³ vs å…¶ä»–é”™è¯¯â€ï¼Œè€Œä¸”åœ¨é«˜å¹¶å‘ä¸‹ï¼Œå¼‚å¸¸æ¯” affected_rows æ…¢ å¦‚æœä½¿ç”¨UNSIGNEDï¼Ÿè¡¨é¢çœ‹èµ·æ¥å¯è¡Œï¼Œä½†ä¸æ¨è åœ¨æŸäº›ç‰ˆæœ¬ SQL_MODE ä¸‹ï¼šè¦ä¹ˆæŠ¥é”™ï¼Œè¦ä¹ˆå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢ï¼Œè¡Œä¸ºä¸ç¨³å®š UNSIGNED è§£å†³çš„æ˜¯â€œå€¼åŸŸâ€ï¼Œä¸æ˜¯å¹¶å‘é€»è¾‘ æ€»ä¹‹åœ¨åç«¯é€»è¾‘å’ŒSQLè¯­å¥çš„ç¼–å†™ä¸­ï¼Œå¯¹äºå‡¡æ˜¯èƒ½å‚ä¸åŠ å‡ä¹˜é™¤çš„å­—æ®µï¼Œéƒ½å‡è®¾æœ‰äººä¼šä¼ è´Ÿæ•°ã€é›¶ã€æå¤§å€¼ ä½¿ç”¨äº‹åŠ¡å›æ»šçš„ä½¿ç”¨MySQL localhost:3306 mall_db_simple SQL SELECT id, stock FROM products WHERE id = 1;+----+-------+| id | stock |+----+-------+| 1 | 99 |+----+-------+1 row in set (0.0039 sec)MySQL localhost:3306 mall_db_simple SQL START TRANSACTION;Query OK, 0 rows affected (0.0002 sec)MySQL localhost:3306 mall_db_simple â˜… SQL UPDATE products SET stock = stock - 1 WHERE id = 1;Query OK, 1 row affected (0.0015 sec)Rows matched: 1 Changed: 1 Warnings: 0MySQL localhost:3306 mall_db_simple â˜… SQL SELECT id, stock FROM products WHERE id = 1;+----+-------+| id | stock |+----+-------+| 1 | 98 |+----+-------+1 row in set (0.0003 sec)MySQL localhost:3306 mall_db_simple â˜… SQL ROLLBACK;Query OK, 0 rows affected (0.0072 sec)MySQL localhost:3306 mall_db_simple SQL SELECT id, stock FROM products WHERE id = 1;+----+-------+| id | stock |+----+-------+| 1 | 99 |+----+-------+1 row in set (0.0003 sec) å¯è§ï¼Œå¼€å§‹ä¹‹å‰ï¼Œidä¸º1çš„å•†å“åº“å­˜99ä¸ªã€‚ç„¶åå¯åŠ¨äº‹åŠ¡ï¼Œå°†å•†å“æ•°é‡æ‰£é™¤1ä¸ªåï¼Œå†æ¬¡æŸ¥çœ‹å•†å“æ•°é‡å·²ç»å˜æˆ98ä¸ªäº†ã€‚ç„¶åä½¿ç”¨å›æ»šã€‚å•†å“æ•°é‡æ²¡æœ‰å˜åŒ– æäº¤çš„ä½¿ç”¨MySQL localhost:3306 mall_db_simple SQL SELECT id, stock FROM products WHERE id = 1;+----+-------+| id | stock |+----+-------+| 1 | 99 |+----+-------+1 row in set (0.0025 sec)MySQL localhost:3306 mall_db_simple SQL begin;Query OK, 0 rows affected (0.0002 sec)MySQL localhost:3306 mall_db_simple â˜… SQL UPDATE products SET stock = stock - 2 WHERE id = 1;Query OK, 1 row affected (0.0005 sec)Rows matched: 1 Changed: 1 Warnings: 0MySQL localhost:3306 mall_db_simple â˜… SQL SELECT id, stock FROM products WHERE id = 1;+----+-------+| id | stock |+----+-------+| 1 | 97 |+----+-------+1 row in set (0.0003 sec)MySQL localhost:3306 mall_db_simple â˜… SQL commit;Query OK, 0 rows affected (0.0045 sec)MySQL localhost:3306 mall_db_simple SQL SELECT id, stock FROM products WHERE id = 1;+----+-------+| id | stock |+----+-------+| 1 | 97 |+----+-------+1 row in set (0.0003 sec) å¯è§ï¼Œå¼€å§‹ä¹‹å‰ï¼Œidä¸º1çš„å•†å“åº“å­˜99ä¸ªã€‚ç„¶åå¯åŠ¨äº‹åŠ¡ï¼Œå°†å•†å“æ•°é‡æ‰£é™¤2ä¸ªåï¼Œå†æ¬¡æŸ¥çœ‹å•†å“æ•°é‡å·²ç»å˜æˆ97ä¸ªäº†ã€‚ä½¿ç”¨commitæäº¤åï¼Œäº‹åŠ¡ç»“æŸã€‚å•†å“åº“å­˜æ‰£é™¤ ä¿å­˜ç‚¹çš„ä½¿ç”¨åœ¨åŒä¸€äº‹åŠ¡ä¸­ï¼Œä¿å­˜ç‚¹åç§°æ˜¯å”¯ä¸€çš„ã€‚å¦‚æœè®¾ç½®ç›¸åŒåç§°çš„ä¿å­˜ç‚¹åç§°ï¼Œåè®¾ç½®çš„ä¿å­˜ç‚¹ä¼šè¦†ç›–å…ˆè®¾ç½®çš„ çœ‹ä¸‹é¢çš„ä¾‹å­ MySQL localhost:3306 mall_db_simple SQL begin;Query OK, 0 rows affected (0.0002 sec)MySQL localhost:3306 mall_db_simple â˜… SQL SELECT id, stock FROM products WHERE id = 1;+----+-------+| id | stock |+----+-------+| 1 | 100 |+----+-------+1 row in set (0.0003 sec)MySQL localhost:3306 mall_db_simple â˜… SQL UPDATE products SET stock = stock - 10 WHERE id = 1;Query OK, 1 row affected (0.0004 sec)Rows matched: 1 Changed: 1 Warnings: 0MySQL localhost:3306 mall_db_simple â˜… SQL SELECT id, stock FROM products WHERE id = 1;+----+-------+| id | stock |+----+-------+| 1 | 90 |+----+-------+1 row in set (0.0003 sec)MySQL localhost:3306 mall_db_simple â˜… SQL savepoint koukuncun1;Query OK, 0 rows affected (0.0002 sec)MySQL localhost:3306 mall_db_simple â˜… SQL UPDATE products SET stock = stock - 20 WHERE id = 1;Query OK, 1 row affected (0.0003 sec)Rows matched: 1 Changed: 1 Warnings: 0MySQL localhost:3306 mall_db_simple â˜… SQL SELECT id, stock FROM products WHERE id = 1;+----+-------+| id | stock |+----+-------+| 1 | 70 |+----+-------+1 row in set (0.0003 sec)MySQL localhost:3306 mall_db_simple â˜… SQL savepoint koukuncun2;Query OK, 0 rows affected (0.0002 sec)MySQL localhost:3306 mall_db_simple â˜… SQL rollback to koukuncun1;Query OK, 0 rows affected (0.0003 sec)MySQL localhost:3306 mall_db_simple â˜… SQL SELECT id, stock FROM products WHERE id = 1;+----+-------+| id | stock |+----+-------+| 1 | 90 |+----+-------+1 row in set (0.0002 sec)MySQL localhost:3306 mall_db_simple â˜… SQL rollback to koukuncun2;ERROR: 1305 (42000): SAVEPOINT koukuncun2 does not existMySQL localhost:3306 mall_db_simple â˜… SQL release savepoint koukuncun1;Query OK, 0 rows affected (0.0002 sec)MySQL localhost:3306 mall_db_simple â˜… SQL UPDATE products SET stock = stock - 20 WHERE id = 1;Query OK, 1 row affected (0.0004 sec)Rows matched: 1 Changed: 1 Warnings: 0MySQL localhost:3306 mall_db_simple â˜… SQL SELECT id, stock FROM products WHERE id = 1;+----+-------+| id | stock |+----+-------+| 1 | 70 |+----+-------+1 row in set (0.0003 sec)MySQL localhost:3306 mall_db_simple â˜… SQL rollback to koukuncun1;ERROR: 1305 (42000): SAVEPOINT koukuncun1 does not exist ä¸€ä¸ªä¼šè¯é‡Œå¯ä»¥è®¾ç½®å¤šä¸ªä¿å­˜ç‚¹ã€‚å¹¶ä¸”å¯ä»¥é€šè¿‡rollback to ä¿å­˜ç‚¹å›åˆ°ä¿å­˜ç‚¹ã€‚ ä½†æ˜¯ï¼Œä¿å­˜ç‚¹ä¸æ˜¯å˜é‡ã€‚å°±æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œåˆ›å»ºäº†ä¿å­˜ç‚¹koukuncun1ååˆåˆ›å»ºäº†ä¿å­˜ç‚¹koukuncun2ã€‚ç„¶åç›´æ¥å›æ»šåˆ°äº†koukuncun1ã€‚è¿™æ—¶å€™å°±ä¸èƒ½å†å›æ»šåˆ°koukuncun2äº†ï¼Œå› ä¸ºkoukuncun2å¯¹äºkoukuncun1æ¥è¯´æ˜¯æœªæ¥å‘ç”Ÿçš„ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨release savepoint ä¿å­˜ç‚¹æŒ‡ä»¤æ¥é‡Šæ”¾ä¿å­˜ç‚¹ã€‚é‡Šæ”¾åçš„ä¿å­˜ç‚¹åŒæ ·ä¸èƒ½å†å›æ»šã€‚ è‡ªåŠ¨æäº¤ï¼Ÿæ‰‹åŠ¨æäº¤ï¼Ÿ ä»€ä¹ˆæ˜¯è‡ªåŠ¨æäº¤ï¼ˆé»˜è®¤ï¼‰ï¼Ÿæ•²ä¸€è¡Œ SQLï¼Œå›è½¦ï¼ŒMySQL ç«‹åˆ»æŠŠå®ƒå­˜è¿›ç¡¬ç›˜ï¼ˆCommitï¼‰ã€‚ çŠ¶æ€ï¼šautocommit = 1 (å¼€å¯) åœºæ™¯ï¼šå¹³æ—¶åœ¨å‘½ä»¤è¡Œé‡Œæ•² UPDATE ...ï¼Œæ²¡æ•² COMMIT æ•°æ®ä¹Ÿæ”¹äº†ï¼Œå°±æ˜¯å› ä¸ºè¿™ä¸ªã€‚ ä»€ä¹ˆæ˜¯æ‰‹åŠ¨æäº¤ï¼Ÿéœ€è¦æ˜¾å¼åœ°å‘Šè¯‰ MySQLï¼šâ€œæˆ‘è¦å¼€å§‹è®°è´¦äº†â€å’Œâ€œæˆ‘è®°å®Œè´¦äº†â€ã€‚ çŠ¶æ€ï¼šautocommit = 0 (å…³é—­) åœºæ™¯ï¼š æ–¹æ³• Aï¼ˆæ¨èï¼Œä¸´æ—¶æ‰‹åŠ¨ï¼‰ï¼šè¾“å…¥ START TRANSACTIONã€‚æ­¤æ—¶ autocommit æš‚æ—¶å¤±æ•ˆï¼Œç›´åˆ°ä½ æ•² COMMIT æˆ– ROLLBACKã€‚ æ–¹æ³• Bï¼ˆå…¨å±€æ‰‹åŠ¨ï¼Œä¸æ¨èï¼‰ï¼šæ‰§è¡Œ SET autocommit = 0;ã€‚è¿™å¾ˆå±é™©ï¼å¦‚æœå¿˜äº†æ•² COMMITï¼Œåšäº†ä¸€å¤©çš„æ“ä½œï¼Œå…³æ‰çª—å£åå…¨éƒ½ä¼šä¸¢ã€‚ é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹å½“å‰çŠ¶æ€ SELECT @@autocommit; ä¸€èˆ¬éƒ½æ˜¯é»˜è®¤å¼€å¯äº†è‡ªåŠ¨æäº¤ MySQL localhost:3306 mall_db_simple SQL SELECT @@autocommit;+--------------+| @@autocommit |+--------------+| 1 |+--------------+1 row in set (0.0001 sec) äº‹åŠ¡çš„éš”ç¦»çº§åˆ«MySQL æä¾›äº† 4 ç§çº§åˆ«ï¼Œå®‰å…¨æ€§ä»ä½åˆ°é«˜ï¼Œæ€§èƒ½ä»é«˜åˆ°ä½ï¼š çº§åˆ« è‹±æ–‡å ç»°å· ç‰¹ç‚¹ ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ 1 Read Uncommitted è¯»æœªæäº¤ è£¸å¥” åˆ«äººè¿˜æ²¡ Commit çš„æ•°æ®å°±èƒ½çœ‹è§ã€‚ï¼ˆè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ï¼‰ 2 Read Committed è¯»å·²æäº¤ (RC) åŠéš”ç¦» åˆ«äºº Commit äº†ï¼Œæ‰èƒ½çœ‹è§ã€‚ï¼ˆå¹»è¯»å’Œä¸å¯é‡å¤è¯»ï¼‰ 3 Repeatable Read å¯é‡å¤è¯» (RR) ç…§éª— MySQL é»˜è®¤ äº‹åŠ¡ä¸€å¼€å§‹ï¼Œå°±æ‹ä¸ªç…§ã€‚ä¸ç®¡åˆ«äººæ€ä¹ˆæ”¹ï¼Œçœ‹åˆ°çš„æ°¸è¿œæ˜¯å¼€å§‹æ—¶çš„æ ·å­ã€‚ 4 Serializable ä¸²è¡ŒåŒ– æ’é˜Ÿ åªè¦æˆ‘æ²¡æå®Œï¼Œåˆ«äººè¿æŸ¥éƒ½ä¸å‡†æŸ¥ã€‚æ…¢åˆ°ä»¤äººå‘æŒ‡ã€‚ é»˜è®¤å¯é‡å¤è¯»çš„åœºæ™¯åœºæ™¯ï¼šï¼ˆçª—å£ Aï¼‰åœ¨æŸ¥è´¦ï¼Œï¼ˆçª—å£ Bï¼‰åœ¨æ”¹æ•°æ®ã€‚ çª—å£ Aï¼šå¼€å¯äº‹åŠ¡ï¼Œå…ˆæŸ¥ä¸€ä¸‹åº“å­˜ã€‚ START TRANSACTION;SELECT stock FROM products WHERE id = 1; çª—å£ Bï¼šå¼€å¯äº‹åŠ¡ï¼Œå–æ‰ 50 ä¸ª UPDATE products SET stock = 50 WHERE id = 1; çª—å£ Aï¼šå†æ¬¡æŸ¥è¯¢åº“å­˜ã€‚ SELECT stock FROM products WHERE id = 1; ç»“æœï¼šè¿˜æ˜¯ 100ï¼ (å“ªæ€•çª—å£ B å·²ç»æ”¹æˆ 50 äº†) åŸå› ï¼šè¿™å°±æ˜¯ Repeatable Readã€‚åœ¨å¼€å¯äº‹åŠ¡çš„é‚£ä¸€åˆ»ï¼ŒMySQL ç»™ä»–ç”Ÿæˆäº†ä¸€ä¸ªâ€œå¿«ç…§â€ã€‚åªè¦ä¸ç»“æŸäº‹åŠ¡ï¼Œå¤–é¢çš„ä¸–ç•Œå¤©å´©åœ°è£‚ï¼Œä»–çœ‹åˆ°çš„æ°¸è¿œæ˜¯ 100ã€‚ çª—å£ Aï¼šç»“æŸæŸ¥è´¦ã€‚ COMMIT;SELECT stock FROM products WHERE id = 1;--ç»“æœï¼š50 å¦‚æœçª—å£Aè¦è·å–å®æ—¶æ•°æ®ï¼Œå°±ä½¿ç”¨ SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; äº‹åŠ¡å¹¶å‘æ‰§è¡Œå¯èƒ½å¼•å‘çš„é—®é¢˜ è„è¯» (Dirty Read)ï¼š ç°è±¡ï¼šA è¯»åˆ°äº† B è¿˜æ²¡æäº¤çš„æ•°æ®ã€‚ç»“æœ B å›æ»šäº†ï¼ŒA è¯»åˆ°çš„æ˜¯å‡æ•°æ®ã€‚ è°æœ‰è¿™æ¯›ç—…ï¼šRead Uncommittedã€‚ ä¸å¯é‡å¤è¯» (Non-repeatable Read)ï¼š ç°è±¡ï¼šA ç¬¬ä¸€æ¬¡è¯»æ˜¯ 100ï¼ŒB æ”¹æˆ 50 æäº¤äº†ï¼ŒA ç¬¬äºŒæ¬¡è¯»å˜æˆ 50ã€‚A æ‡µäº†ï¼šâ€œæ€ä¹ˆä¸€ä¼šå„¿ä¸€ä¸ªæ ·ï¼Ÿâ€ è°æœ‰è¿™æ¯›ç—…ï¼šRead Committed ã€‚ å¹»è¯» (Phantom Read)ï¼š ç°è±¡ï¼šA æŸ¥æ‰€æœ‰è®¢å•ï¼Œå‘ç°æœ‰ 5 ä¸ªã€‚B å·å·æ’å…¥äº†ä¸€ä¸ªæ–°è®¢å•ã€‚A å‡†å¤‡ä¿®æ”¹è¿™ 5 ä¸ªè®¢å•ï¼Œç»“æœå‘ç°æ•°æ®åº“é‡Œæœ‰ 6 ä¸ªè®¢å•å—å½±å“ã€‚A è§‰å¾—å‡ºç°äº†å¹»è§‰ã€‚ åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¿æŒé»˜è®¤ (Repeatable Read) å°±è¡Œ MySQL çš„é»˜è®¤è®¾ç½®å·²ç»éå¸¸ä¼˜ç§€ï¼Œèƒ½é¿å…å¤§å¤šæ•°å¹¶å‘å‘ã€‚ åªæœ‰åœ¨æå°‘æ•°å¯¹â€œå®æ—¶æ€§â€è¦æ±‚æé«˜ï¼Œä¸”ä¸ºäº†å‡å°‘æ­»é”çš„åœºæ™¯ä¸‹ï¼ˆæ¯”å¦‚ 12306 æŠ¢ç¥¨ï¼‰ï¼Œæ‰ä¼šå»è€ƒè™‘æ”¹ä¸º RCã€‚ä¸è¿‡ä¸Šé¢çš„é‚£äº›å†…å®¹ä¹Ÿæ˜¯é¢è¯•ç‹—å®˜çˆ±é—®çš„ã€‚ é—´éš™é”é—´éš™é” (Gap Lock) æ˜¯ MySQL (InnoDB) é‡Œçš„ç‰¹æ€§ï¼Œä¹Ÿæ˜¯åªæœ‰åœ¨ RRï¼ˆå¯é‡å¤è¯»ï¼‰éš”ç¦»çº§åˆ«ä¸‹æ‰ä¼šç”Ÿæ•ˆçš„ç‰¹æ®Šé”æœºåˆ¶ã€‚ ä¸éœ€è¦ä¸“é—¨å†™ SQL å»è°ƒç”¨å®ƒã€‚åªè¦éš”ç¦»çº§åˆ«æ˜¯é»˜è®¤çš„ Repeatable Read (RR)ï¼Œå¹¶ä¸”æ‰§è¡Œäº†èŒƒå›´æŸ¥è¯¢çš„åŠ é”æ“ä½œï¼ŒMySQL å°±ä¼šè‡ªåŠ¨è§¦å‘é—´éš™é”ã€‚ å¦‚æœæ²¡æœ‰é—´éš™é”åœºæ™¯ï¼šäº‹åŠ¡Aè¦æŸ¥ ID 10 çš„æ‰€æœ‰è®¢å•ã€‚ç›®å‰åªæœ‰ ID11, ID13 ä¸¤æ¡ã€‚ åŠ¨ä½œï¼šäº‹åŠ¡Aæ‰§è¡Œ SELECT * FROM orders WHERE id 10 FOR UPDATE;ï¼ˆé”ä½æŸ¥åˆ°çš„æ•°æ®ï¼‰ã€‚ æ¼æ´ï¼šå¦‚æœæ²¡æœ‰é—´éš™é”ï¼Œåªé”ä½äº† 11 å’Œ 13ã€‚è¿™æ—¶å€™äº‹åŠ¡Bå·å·æ’å…¥äº†ä¸€æ¡ ID12 çš„æ•°æ®ã€‚ ç»“æœï¼šäº‹åŠ¡Aè¿˜æ²¡æäº¤äº‹åŠ¡ï¼Œå†æŸ¥ä¸€æ¬¡ï¼Œå‘ç°çªç„¶å¤šå‡ºæ¥ä¸€ä¸ª 12ï¼è§é¬¼äº†ï¼ˆå¹»è¯»ï¼‰ã€‚é—´éš™é”çš„ä½œç”¨ï¼šäº‹åŠ¡Aä¸ä»…æŠŠ 11 å’Œ 13 é”ä½ï¼Œè¿˜æ‹‰èµ·äº†è­¦æˆ’çº¿â€”â€”â€œæŠŠ 11 å’Œ 13 ä¸­é—´çš„ç©ºä½ã€13 åé¢çš„ç©ºä½å…¨å°æ­»ï¼è°ä¹Ÿä¸å‡†å¾€é‡Œæ’æ•°æ®ï¼â€ é—´éš™é”çš„å·¥ä½œé¦–å…ˆå…ˆåˆ›å»ºä¸€ä¸ªå¾ˆç®€å•çš„è¡¨ CREATE TABLE gap_test ( id INT PRIMARY KEY) ENGINE=InnoDB;INSERT INTO gap_test VALUES (1), (5), (10); åœ¨å…¶ä¸­ä¸€ä¸ªçª—å£å¯åŠ¨äº‹åŠ¡æŸ¥è¯¢é‡Œé¢çš„æ•°æ® MySQL localhost:3306 mall_db_simple SQL START TRANSACTION;Query OK, 0 rows affected (0.0002 sec)MySQL localhost:3306 mall_db_simple â˜… SQL SELECT * FROM gap_test WHERE id 1 AND id 10 FOR UPDATE;+----+| id |+----+| 5 |+----+1 row in set (0.0004 sec) è¿™æ—¶å€™å†åˆ°å¦ä¸€ä¸ªçª—å£å¯åŠ¨äº‹åŠ¡ï¼Œå¹¶å°è¯•å¾€è¿™äº›â€œç©ºä½â€é‡Œæ’æ•°æ®ã€‚ MySQL localhost:3306 SQL START TRANSACTION;Query OK, 0 rows affected (0.0002 sec)MySQL localhost:3306 â˜… SQL use mall_db_simple;Default schema set to `mall_db_simple`.Fetching global names, object names from `mall_db_simple` for auto-completion... Press ^C to stop.MySQL localhost:3306 mall_db_simple â˜… SQL INSERT INTO gap_test VALUES (2); å¡åœ¨è¿™é‡Œä¸åŠ¨äº†ï¼Œå› ä¸ºåœ¨ç¬¬ä¸€ä¸ªçª—å£ MySQL ä¼šè‡ªåŠ¨åŠ ä¸Šé—´éš™é”ï¼Œé”ä½ (1, 5) å’Œ (5, 10) è¿™ä¸¤ä¸ªåŒºé—´ é—´éš™é”å¯¼è‡´çš„æ­»é” A ç”¨æˆ·æƒ³æ³¨å†Œåå­—å«â€œå“ˆåŸºç±³â€ï¼Œç”±äºå¹¶å‘é€»è¾‘ï¼Œä»–å…ˆç”¨ SELECT * FROM users WHERE name = å“ˆåŸºç±³ FOR UPDATE æŸ¥ä¸€ä¸‹æœ‰æ²¡æœ‰ã€‚ å‡è®¾æ•°æ®åº“é‡Œæ²¡è¿™äººã€‚MySQL åŠ ä¸Šäº†é—´éš™é”ï¼ˆé”ä½äº†è¿™ä¸€ç‰‡ä¸å­˜åœ¨çš„åŒºåŸŸï¼‰ã€‚ B ç”¨æˆ·åŒæ—¶ä¹Ÿæƒ³æ³¨å†Œâ€œå“ˆåŸºç±³â€ï¼Œä¹Ÿæ‰§è¡Œäº†åŒæ ·çš„ SQLã€‚ é—´éš™é”å’Œé—´éš™é”ä¹‹é—´æ˜¯ä¸å†²çªçš„ï¼B ç”¨æˆ·ä¹ŸåŠ ä¸Šäº†é—´éš™é”ã€‚ A ç”¨æˆ·æ‰§è¡Œ INSERT ... å“ˆåŸºç±³ã€‚ å´©äº†ï¼šA è¢« B çš„é—´éš™é”æŒ¡ä½äº†ã€‚ B ç”¨æˆ·æ‰§è¡Œ INSERT ... å“ˆåŸºç±³ã€‚ å´©äº†ï¼šB è¢« A çš„é—´éš™é”æŒ¡ä½äº†ã€‚ MySQL æŠ¥é”™ â€œDeadlock foundâ€ï¼Œå…¶ä¸­ä¸€ä¸ªç”¨æˆ·ç›´æ¥æŠ¥é”™é€€å‡ºã€‚ å¦‚æœä¸éœ€è¦æå…¶ä¸¥æ ¼çš„é˜²å¹»è¯»ï¼ˆå¤§å¤šæ•°äº’è”ç½‘ä¸šåŠ¡éƒ½ä¸éœ€è¦ï¼‰ï¼Œå¯ä»¥é€‰æ‹©æŠŠéš”ç¦»çº§åˆ«é™çº§ä¸º RC (Read Committed)ã€‚åœ¨ RC çº§åˆ«ä¸‹ï¼Œé—´éš™é”ä¼šè‡ªåŠ¨å…³é—­ã€‚è¿™æ ·èƒ½å¤§å¤§å‡å°‘æ­»é”ï¼Œæå‡å¹¶å‘åº¦ã€‚","tags":["Mysql","Database","notebook"]},{"title":"Mysqlæ”»ç•¥-å®‰è£…ä½¿ç”¨åˆ°åŸºç¡€çš„å¢åˆ æ”¹æŸ¥","path":"/2026/01/02/mysql-quick/","content":"çœ‹å®Œæœ¬æ–‡ä½ å°†é€Ÿé€šMysqlåŸºæœ¬æ“ä½œå’Œæœ€å¸¸ç”¨çš„å¢åˆ æ”¹æŸ¥ã€‚çœ‹å®Œä½ å°±æ˜¯sqlboy å¦‚æœä½ å†çœ‹å®Œ Mysqlæ”»ç•¥-è¿›é˜¶åŠŸèƒ½ è¿™ç¯‡æ–‡ç« ï¼Œä½ å°†é€Ÿé€šï¼šè¿è¡¨æŸ¥è¯¢ï¼Œåˆ†ç»„ä¸ç»Ÿè®¡ï¼Œå­æŸ¥è¯¢ï¼Œäº‹åŠ¡ï¼Œç´¢å¼•ï¼Œçª—å£å‡½æ•°ï¼Œæ‚²è§‚é”ï¼Œå¤„ç† JSON æ•°æ®ï¼Œå¤æ‚é€»è¾‘å¤„ç†(if else)ï¼Œæ€§èƒ½åˆ†æï¼Œå­˜å‚¨è¿‡ç¨‹ä¸è§¦å‘å™¨ç­‰ç­‰é«˜çº§åŠŸèƒ½ä½ ä¼šç¬é—´å˜æˆMysqlé«˜æ‰‹ é€šè¿‡Dockerå®‰è£…å’Œä½¿ç”¨Mysqlå®‰è£…å’Œå¯åŠ¨è¿™é‡Œæˆ‘ç”¨dockeräº†ï¼Œå› ä¸ºubuntuçš„aptæºé‡Œé¢æ²¡æœ‰mysqlï¼Œå®‰è£…çš„è¯éšæ„äº†å–œæ¬¢å“ªç§æ–¹å¼ç”¨é‚£ç§æ–¹å¼ cloudyou@cloudyou-i1025P:~$ docker pull mysqlUsing default tag: latestlatest: Pulling from library/mysqlDigest: sha256:5ca0a273ed28c73acaef91da8bf1eca3711bee94bce4c378d42846375e645a72Status: Downloaded newer image for mysql:latestdocker.io/library/mysql:latestcloudyou@cloudyou-i1025P:~$ docker run -d \\ --name mysql-test \\ -e MYSQL_ROOT_PASSWORD=123456 \\ -p 3306:3306 \\ mysql1ca08ce15790ffddff0440424b3c589a68f5c09aac5110632f9959a1485e8cloudyou@cloudyou-i1025P:~$ docker psCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES1ca08ce15790 mysql docker-entrypoint.sâ€¦ About a minute ago Up About a minute 0.0.0.0:3306-3306/tcp, [::]:3306-3306/tcp, 33060/tcp mysql-testdcc ç”¨å…ˆæŠŠmysql pullä¸‹æ¥åï¼Œä½¿ç”¨äº†docker runæ¥è¿è¡Œã€‚ -dï¼šåå°è¿è¡Œï¼Œä¸éœ¸å ç»ˆç«¯ --name mysql-testï¼šç»™å®¹å™¨èµ·ä¸ªåå­—ï¼Œæ–¹ä¾¿åé¢æŠ˜è…¾ MYSQL_ROOT_PASSWORD=123456ï¼šæŒ‡å®šMysqlçš„rootç”¨æˆ·å¯†ç  -p 3306:3306ï¼šå®¿ä¸»æœº â†” å®¹å™¨ç«¯å£æ‰“é€š mysqlï¼šåˆš pull ä¸‹æ¥çš„é‚£ä¸ªé•œåƒ ç°åœ¨ä½¿ç”¨docker pså°±å¯ä»¥çœ‹åˆ°mysqlçš„å®¹å™¨åœ¨è¿è¡Œäº† åœæ­¢åˆ é™¤è¿™ä¸ªå®¹å™¨ä½¿ç”¨docker stop å®¹å™¨å æˆ–è€… docker kill å®¹å™¨å cloudyou@cloudyou-i1025P:~$ docker stop mysql-testmysql-testcloudyou@cloudyou-i1025P:~$ docker psCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMEScloudyou@cloudyou-i1025P:~$ å¯ä»¥çœ‹åˆ°æ²¡ä¸œè¥¿äº† åˆ é™¤çš„è¯åŒç†ï¼Œä½¿ç”¨ docker rm å®¹å™¨å å°±è¡Œï¼Œè¿™é‡Œä¸æ¼”ç¤ºäº† execè¿›å…¥sql shellä½¿ç”¨ docker exec -it mysql-test mysql -uroot -p -it å…¶å®æ˜¯ä¸¤ä¸ªå‚æ•°çš„åˆä½“å†™æ³•ï¼š -i interactiveï¼ˆä¿æŒæ ‡å‡†è¾“å…¥ï¼‰ï¼Œè®©é”®ç›˜è¾“å…¥èƒ½ä¼ è¿›å®¹å™¨ -t ttyï¼ˆåˆ†é…ä¸€ä¸ªç»ˆç«¯ï¼‰ï¼Œç»™ä¸€ä¸ªâ€œåƒç»ˆç«¯ä¸€æ ·â€çš„äº¤äº’ç•Œé¢ cloudyou@cloudyou-i1025P:~$ docker exec -it mysql-test mysql -uroot -pEnter password: Welcome to the MySQL monitor. Commands end with ; or \\g.Your MySQL connection id is 10Server version: 9.5.0 MySQL Community Server - GPLCopyright (c) 2000, 2025, Oracle and/or its affiliates.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Type help; or \\h for help. Type \\c to clear the current input statement.mysql ä½¿ç”¨Mysql Shellè¿æ¥åˆ°æ•°æ®åº“ä½¿ç”¨ \\connect ç”¨æˆ·å@æ•°æ®åº“åœ°å€ æ¥è¿æ¥åˆ°æ•°æ®åº“ Mysql Shellæ˜¯æ”¯æŒPython js å’Œ sql çš„ï¼Œå¦‚æœä¸æ˜¯SQLé‚£è¦å…ˆ \\sql åˆ‡æ¢åˆ°sqlè¯­å¥ MySQL SQL \\connect root@192.168.31.238Creating a session to root@192.168.31.238Please provide the password for root@192.168.31.238: ******Save password for root@192.168.31.238? [Y]es/[N]o/Ne[v]er (default No): YFetching global names for auto-completion... Press ^C to stop.Your MySQL connection id is 9Server version: 9.5.0 MySQL Community Server - GPLNo default schema selected; type \\use schema to set one.MySQL 192.168.31.238:3306 ssl SQL ä¸Šæ‰‹ä¹‹å‰è‡ªå¸¦çš„æ•°æ®åº“å¹²å˜›ç”¨çš„ï¼Ÿè¿›å…¥sql shellåï¼Œä½¿ç”¨show databases;å¯ä»¥çœ‹åˆ°è‡ªå¸¦äº†4ä¸ªæ•°æ®åº“ MySQL 192.168.31.238:3306 ssl SQL show databases;+--------------------+| Database |+--------------------+| information_schema || mysql || performance_schema || sys |+--------------------+4 rows in set (0.0164 sec) mysqlè¿™æ˜¯æœ€è€ã€æœ€é‡è¦çš„åº“ã€‚é‡Œé¢è£…çš„æ˜¯ä»€ä¹ˆï¼Ÿ ç”¨æˆ·è´¦å·ï¼Œå¯†ç å“ˆå¸Œï¼Œæƒé™ï¼Œè§’è‰²ï¼Œgrant è§„åˆ™ å¸¸è§è¡¨ï¼š mysql.user mysql.db mysql.tables_priv ç”¨æˆ·èƒ½ä¸èƒ½è¿ã€èƒ½å¹²å•¥ï¼Œå…¨å†™åœ¨ mysql é‡Œ information_schemaè¿™æ˜¯ä¸€ä¸ªåªè¯»çš„ã€è™šæ‹Ÿçš„åº“ã€‚å®ƒä¸å­˜æ•°æ®ï¼Œåªåæ˜ â€œç°åœ¨çš„çŠ¶æ€â€ æ¯”å¦‚ï¼šæœ‰å“ªäº›åº“ï¼Œæœ‰å“ªäº›è¡¨ï¼Œå­—æ®µç±»å‹ï¼Œç´¢å¼•ï¼Œè¡¨å¤§å° æ¯”å¦‚å¸¸è§çš„ SHOW TABLES;å…¶å®ç­‰ä»·äºSELECT * FROM information_schema.tables WHERE table_schema = xxx; ä»–æ˜¯è¯´æ˜ç°åœ¨Mysqlé•¿ä»€ä¹ˆæ · performance_schemaè¿™æ˜¯ MySQL çš„ç›‘æ§ç³»ç»Ÿã€‚çœ‹ SQL æ…¢ä¸æ…¢ï¼Œå“ªäº›é”å¡äººï¼ŒIO ç”¨é‡ï¼Œå†…å­˜æ¶ˆè€—ï¼Œçº¿ç¨‹çŠ¶æ€ æ…¢æŸ¥è¯¢ã€æ€§èƒ½åˆ†æå·¥å…·ï¼ŒèƒŒåå¤§å¤šåœ¨è¯»å®ƒã€‚ ç‰¹ç‚¹ï¼šæ•°æ®æ˜¯å®æ—¶çš„ï¼Œé‡å¯ä¼šæ¸…ç©ºï¼Œå¯¹æ€§èƒ½æœ‰è½»å¾®å½±å“ï¼ˆå¯é…ç½®ï¼‰ å®ƒè®°å½• MySQLâ€œç°åœ¨ç´¯ä¸ç´¯â€ sysè¿™æ˜¯ä¸ªâ€œè§†å›¾åº“â€ï¼Œä¸æ˜¯åŸå§‹æ•°æ®ã€‚å®ƒå¹²äº†å•¥ï¼Ÿ æŠŠÂ performance_schemaÂ é‡Œä¸€å †è¡¨ï¼ŒåŒ…è£…æˆå¥½è¯»çš„è§†å›¾ æ€»ä¹‹Â sys performance_schema çš„ç²¾è£…ä¿®ç‰ˆ Mysqlçš„æ•°æ®ç±»å‹å’Œç¼–ç¨‹è¯­è¨€ç±»ä¼¼ï¼ŒMysqlä¹Ÿæä¾›äº†å¤šç§æ•°æ®ç±»å‹ æ•°å€¼ç±»å‹å…³é”®å­—INTæ˜¯INTEGERçš„åŒä¹‰è¯ï¼Œå…³é”®å­—DECæ˜¯DECIMALçš„åŒä¹‰è¯ã€‚ ç±»å‹ å¤§å° èŒƒå›´ï¼ˆæœ‰ç¬¦å·ï¼‰ ç”¨é€” TINYINT 1 Bytes (-128ï¼Œ127) å°æ•´æ•°å€¼ SMALLINT 2 Bytes (-32 768ï¼Œ32 767) å¤§æ•´æ•°å€¼ MEDIUMINT 3 Bytes (-8 388 608ï¼Œ8 388 607) å¤§æ•´æ•°å€¼ INTæˆ–INTEGER 4 Bytes (-2 147 483 648ï¼Œ2 147 483 647) å¤§æ•´æ•°å€¼ BIGINT 8 Bytes (-9,223,372,036,854,775,808ï¼Œ9 223 372 036 854 775 807) æå¤§æ•´æ•°å€¼ FLOAT 4 Bytes (-3.402 823 466 E+38ï¼Œ-1.175 494 351 E-38)ï¼Œ0ï¼Œ(1.175 494 351 E-38ï¼Œ3.402 823 466 351 E+38) å•ç²¾åº¦ æµ®ç‚¹æ•°å€¼ DOUBLE 8 Bytes (-1.797 693 134 862 315 7 E+308ï¼Œ-2.225 073 858 507 201 4 E-308)ï¼Œ0ï¼Œ(2.225 073 858 507 201 4 E-308ï¼Œ1.797 693 134 862 315 7 E+308) åŒç²¾åº¦ æµ®ç‚¹æ•°å€¼ DECIMAL å¯¹DECIMAL(M,D) ï¼Œå¦‚æœMDï¼Œä¸ºM+2å¦åˆ™ä¸ºD+2 ä¾èµ–äºMå’ŒDçš„å€¼ å°æ•°å€¼ å®é™…ä¸šåŠ¡é‡Œå¸¸ç”¨çš„: TINYINT (1å­—èŠ‚) èŒƒå›´ï¼š-128 ~ 127ã€‚ åœºæ™¯ï¼šçŠ¶æ€æ ‡è¯†ã€å¸ƒå°”å€¼ã€‚ ä¾‹å­ï¼šstatus (0å¾…ä»˜æ¬¾, 1å·²ä»˜æ¬¾, 2å·²å‘è´§)ï¼Œis_vip (0å¦, 1æ˜¯)ã€‚ æ³¨æ„ï¼šMySQL é‡Œæ²¡æœ‰ Boolean ç±»å‹ï¼Œé€šå¸¸ç”¨ TINYINT(1) æ¥å­˜ truefalseã€‚ INT (4å­—èŠ‚) èŒƒå›´ï¼šÂ±21äº¿ã€‚ åœºæ™¯ï¼šå¤§å¤šæ•°è¡¨çš„ä¸»é”® IDã€åº“å­˜æ•°é‡ã€è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰ã€‚ æŠ€å·§ï¼šå¦‚æœä¸å­˜è´Ÿæ•°ï¼ˆæ¯”å¦‚åº“å­˜ï¼‰ï¼Œå»ºè®®åŠ ä¸Š UNSIGNEDï¼ŒèŒƒå›´èƒ½ç¿»å€åˆ° 42äº¿ã€‚ BIGINT (8å­—èŠ‚) èŒƒå›´ï¼šæå¤§ï¼ˆ19ä½æ•°å­—ï¼‰ã€‚ åœºæ™¯ï¼šä¸»é”® IDï¼ˆè®¢å•è¡¨ï¼‰ã€è§†é¢‘æ’­æ”¾é‡ï¼ˆåƒ YouTube è¿™ç§çº§åˆ«ï¼‰ã€‚ è­¦ç¤ºï¼šç”µå•†çš„è®¢å•å·é€šå¸¸å¾ˆé•¿ï¼ˆæ¯”å¦‚é›ªèŠ±ç®—æ³•ç”Ÿæˆçš„ IDï¼‰ï¼ŒINT å­˜ä¸ä¸‹ï¼Œå¿…é¡»ç”¨ BIGINTã€‚ å°æ•°éƒ¨åˆ†å¦‚æœå’Œé’±æœ‰å…³çš„è¯ï¼Œä¸è¦ç”¨FLOAT DOUBLE å®ƒä»¬æ˜¯æµ®ç‚¹æ•°ï¼Œä¼šæœ‰ç²¾åº¦ä¸¢å¤±ã€‚å­˜ 19.9ï¼Œå¯èƒ½æ•°æ®åº“é‡Œå˜æˆ 19.900000001 æˆ– 19.89999999ã€‚ å’Œé’±ç›¸å…³çš„ä¸šåŠ¡ä½¿ç”¨ï¼šDECIMAL(M, D) å®ƒæ˜¯å®šç‚¹æ•°ï¼Œç²¾å‡†å­˜å‚¨ã€‚ åœºæ™¯ï¼šå•†å“ä»·æ ¼ã€é’±åŒ…ä½™é¢ã€‚ å¸¸ç”¨é…ç½®ï¼šDECIMAL(10, 2)ã€‚ 10 è¡¨ç¤ºæ€»å…± 10 ä½æ•°å­—ï¼ˆåº”å¯¹äº¿å…ƒçº§åˆ«çš„é‡‘é¢ï¼‰ã€‚ 2 è¡¨ç¤ºå°æ•°ç‚¹åä¿ç•™ 2 ä½ï¼ˆç²¾ç¡®åˆ°åˆ†ï¼‰ã€‚ æ—¥æœŸå’Œæ—¶é—´ç±»å‹è¡¨ç¤ºæ—¶é—´å€¼çš„æ—¥æœŸå’Œæ—¶é—´ç±»å‹ä¸ºDATETIMEã€DATEã€TIMESTAMPã€TIMEå’ŒYEARã€‚ æ¯ä¸ªæ—¶é—´ç±»å‹æœ‰ä¸€ä¸ªæœ‰æ•ˆå€¼èŒƒå›´å’Œä¸€ä¸ªâ€é›¶â€å€¼ï¼Œå½“æŒ‡å®šä¸åˆæ³•çš„MySQLä¸èƒ½è¡¨ç¤ºçš„å€¼æ—¶ä½¿ç”¨â€é›¶â€å€¼ã€‚ ç±»å‹ å¤§å° ( bytes) æ ¼å¼ ç”¨é€” DATE 3 YYYY-MM-DD æ—¥æœŸå€¼ TIME 3 HH:MM:SS æ—¶é—´å€¼æˆ–æŒç»­æ—¶é—´ YEAR 1 YYYY å¹´ä»½å€¼ DATETIME 8 YYYY-MM-DD hh:mm:ss æ··åˆæ—¥æœŸå’Œæ—¶é—´å€¼ TIMESTAMP 4 YYYY-MM-DD hh:mm:ss æ··åˆæ—¥æœŸå’Œæ—¶é—´å€¼ï¼Œæ—¶é—´æˆ³ DATETIME åœºæ™¯ï¼šè®¢å•åˆ›å»ºæ—¶é—´ã€ç”¨æˆ·æ³¨å†Œæ—¶é—´ã€‚ ä¼˜ç‚¹ï¼šç›´è§‚ï¼Œå­˜ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆï¼Œä¸å—æ—¶åŒºå½±å“ TIMESTAMP (æ—¶é—´æˆ³) åœºæ™¯ï¼šè®°å½•æ•°æ®æœ€åä¿®æ”¹æ—¶é—´ï¼ˆON UPDATE CURRENT_TIMESTAMPï¼‰ã€‚ ç¼ºç‚¹ï¼šæ—¶åŒºè½¬æ¢é—®é¢˜ï¼Œä¸”è¿™ä¸ªæ•°æ®ç±»å‹æœ‰â€œ2038å¹´è™«å±æœºâ€ï¼ˆæ—§ç‰ˆæœ¬ MySQL åªèƒ½å­˜åˆ° 2038 å¹´ï¼‰ï¼Œæ‰€ä»¥ç°åœ¨å¾ˆå¤šæ–°ç³»ç»Ÿå€¾å‘äºç”¨ DATETIME æˆ–ç›´æ¥å­˜ BIGINT (æ¯«ç§’æ—¶é—´æˆ³)ã€‚ å­—ç¬¦ä¸²ç±»å‹åå­—ã€æè¿°ã€é“¾æ¥ ç±»å‹ å¤§å° ç”¨é€” CHAR 0-255 bytes å®šé•¿å­—ç¬¦ä¸² VARCHAR 0-65535 bytes å˜é•¿å­—ç¬¦ä¸² TINYBLOB 0-255 bytes ä¸è¶…è¿‡ 255 ä¸ªå­—ç¬¦çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸² TINYTEXT 0-255 bytes çŸ­æ–‡æœ¬å­—ç¬¦ä¸² BLOB 0-65 535 bytes äºŒè¿›åˆ¶å½¢å¼çš„é•¿æ–‡æœ¬æ•°æ® TEXT 0-65 535 bytes é•¿æ–‡æœ¬æ•°æ® MEDIUMBLOB 0-16 777 215 bytes äºŒè¿›åˆ¶å½¢å¼çš„ä¸­ç­‰é•¿åº¦æ–‡æœ¬æ•°æ® MEDIUMTEXT 0-16 777 215 bytes ä¸­ç­‰é•¿åº¦æ–‡æœ¬æ•°æ® LONGBLOB 0-4 294 967 295 bytes äºŒè¿›åˆ¶å½¢å¼çš„æå¤§æ–‡æœ¬æ•°æ® LONGTEXT 0-4 294 967 295 bytes æå¤§æ–‡æœ¬æ•°æ® CHAR(N) (å›ºå®šé•¿åº¦) åœºæ™¯ï¼šMD5 å€¼ã€æ‰‹æœºå·ã€èº«ä»½è¯å·ã€å›½å®¶ä»£ç  (â€˜CNâ€™, â€˜USâ€™)ã€‚ ç†ç”±ï¼šé€Ÿåº¦æå¿«ï¼Œä¸å®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚æ¯”å¦‚å¯†ç åŠ å¯†åå›ºå®šæ˜¯ 32 ä½ï¼Œå°±ç”¨ CHAR(32)ã€‚ VARCHAR(N) (å¯å˜é•¿åº¦) åœºæ™¯ï¼šç”¨æˆ·åã€å•†å“æ ‡é¢˜ã€è§†é¢‘é“¾æ¥ (URL)ã€è¯„è®ºã€‚ æ³¨æ„ï¼šN ä»£è¡¨å­—ç¬¦æ•°ï¼ˆä¸æ˜¯å­—èŠ‚ï¼‰ã€‚VARCHAR(255) æ˜¯ä¸ªä¹ æƒ¯å†™æ³•ï¼Œä½†å¦‚æœæ ‡é¢˜åªæœ‰ 20 å­—ï¼Œå†™ VARCHAR(50) ç´¢å¼•æ•ˆç‡ä¼šæ›´é«˜ä¸€ç‚¹ç‚¹ã€‚ TEXT MEDIUMTEXT (å¤§æ–‡æœ¬) åœºæ™¯ï¼šå•†å“è¯¦æƒ…é¡µ HTML ä»£ç ã€åšå®¢æ­£æ–‡ã€‚ å‘ç‚¹ï¼šæŸ¥è¯¢æ—¶å¦‚æœæ²¡å¿…è¦ï¼Œåƒä¸‡åˆ« SELECT * æŠŠ TEXT å­—æ®µä¹ŸæŸ¥å‡ºæ¥ï¼Œéå¸¸æ‹–æ…¢ç½‘ç»œä¼ è¾“å’Œå†…å­˜ã€‚ CHARå’ŒVARCHARçš„åŒºåˆ«ï¼Ÿcharæ˜¯ä¸ªå®šé•¿çš„ï¼Œæ¯”å¦‚char(10) ,ä¸ç®¡å­˜å‡ ä¸ªå­—ç¬¦ï¼Œéƒ½å  10 ä¸ªå­—ç¬¦ç©ºé—´ã€‚æ²¡ç”¨æ»¡çš„éƒ¨åˆ†ï¼Œä¼šç”¨ç©ºæ ¼è¡¥é½ã€‚ varcharæ˜¯åŠ¨æ€é•¿åº¦çš„ï¼Œæ¯”å¦‚varchar(10),æœ€å¤š 10 ä¸ªå­—ç¬¦ï¼Œç”¨å¤šå°‘å å¤šå°‘ã€‚çœç©ºé—´ ä»€ä¹ˆæ—¶å€™ç”¨CHARï¼Ÿ åœºæ™¯ ç±»å‹ UUIDï¼ˆ32ä½ï¼‰ CHAR(32) MD5 CHAR(32) SHA1 CHAR(40) å›½å®¶ä»£ç  CHAR(2) æ€§åˆ« CHAR(1) é•¿åº¦æ°¸è¿œå›ºå®šçš„åœºæ™¯ï¼Œç”¨ VARCHAR åè€Œå¤šæ­¤ä¸€ä¸¾ã€‚ Mysqlçš„è¿ç®—ç¬¦åŒç†ï¼ŒMysqlä¹Ÿæä¾›äº†ç”¨äºæŸ¥è¯¢çš„æ—¶å€™é™å®šæ¡ä»¶çš„è¿ç®—ç¬¦ï¼Œè¿™é‡Œåˆ—å‡ºäº›å¸¸ç”¨çš„ æ¯”è¾ƒè¿ç®—ç¬¦æœ€åŸºç¡€çš„è¿‡æ»¤æ–¹å¼ï¼Œç”¨äºæ•°å€¼æˆ–å­—ç¬¦ä¸²çš„ç²¾ç¡®æ¯”è¾ƒã€‚ è¿ç®—ç¬¦ å«ä¹‰ ç¤ºä¾‹ = ç­‰äº WHERE score = 100 æˆ– != ä¸ç­‰äº WHERE status != deleted å¤§äº å°äº WHERE price 50 = = å¤§äºç­‰äº å°äºç­‰äº WHERE age = 18 BETWEEN ... AND ... åœ¨èŒƒå›´å†…ï¼ˆå«è¾¹ç•Œï¼‰ WHERE age BETWEEN 20 AND 30 é€»è¾‘è¿ç®—ç¬¦å½“æœ‰å¤šä¸ªæ¡ä»¶éœ€è¦åŒæ—¶åˆ¤æ–­æ—¶ï¼Œä½¿ç”¨é€»è¾‘è¿ç®—ç¬¦è¿›è¡Œç»„åˆã€‚ ANDï¼šæ‰€æœ‰æ¡ä»¶éƒ½å¿…é¡»æ»¡è¶³ï¼ˆä¸”ï¼‰ã€‚ ORï¼šåªè¦æ»¡è¶³å…¶ä¸­ä¸€ä¸ªæ¡ä»¶å³å¯ï¼ˆæˆ–ï¼‰ã€‚ NOTï¼šå–åï¼Œæ’é™¤ç¬¦åˆæ¡ä»¶çš„è¡Œã€‚ ç¤ºä¾‹ï¼š WHERE age 18 AND gender = female æ¨¡ç³ŠåŒ¹é…ä¸é›†åˆ LIKEï¼šæ¨¡ç³ŠæŸ¥è¯¢ï¼Œé…åˆ %ï¼ˆä»»æ„ä¸ªå­—ç¬¦ï¼‰å’Œ _ï¼ˆå•ä¸ªå­—ç¬¦ï¼‰ä½¿ç”¨ã€‚ IN (...)ï¼šæŸ¥è¯¢å­—æ®µå€¼æ˜¯å¦åœ¨ç»™å®šçš„é›†åˆä¸­ã€‚ ç¤ºä¾‹ï¼š WHERE city IN (åŒ—äº¬, ä¸Šæµ·, å¹¿å·) IS NULLï¼šåˆ¤æ–­æŸä¸ªå­—æ®µæ˜¯å¦ä¸ºç©ºï¼ˆæ³¨æ„ï¼šä¸èƒ½ç”¨ = NULLï¼‰ã€‚ æ•°æ®åº“æ“ä½œåˆ›å»ºï¼Œåˆ é™¤ï¼Œä½¿ç”¨~~ åˆ›å»ºæ•°æ®åº“ä½¿ç”¨Â createÂ å‘½ä»¤åˆ›å»ºæ•°æ®åº“ CREATE DATABASE æ•°æ®åº“å; æ¯”å¦‚æˆ‘åˆ›å»ºä¸€ä¸ªå“ˆåŸºç±³æ•°æ®åº“ MySQL 192.168.31.238:3306 ssl SQL create database Hachimi;Query OK, 1 row affected (0.1453 sec)MySQL 192.168.31.238:3306 ssl SQL show databases;+--------------------+| Database |+--------------------+| Hachimi || information_schema || mysql || performance_schema || sys |+--------------------+5 rows in set (0.0167 sec) åˆ é™¤æ•°æ®åº“ä½¿ç”¨ drop å‘½ä»¤åˆ é™¤æ•°æ®ï¼ŒIF EXISTSÂ æ˜¯ä¸€ä¸ªå¯é€‰çš„å­å¥ï¼Œè¡¨ç¤ºå¦‚æœæ•°æ®åº“å­˜åœ¨æ‰æ‰§è¡Œåˆ é™¤æ“ä½œã€‚ DROP DATABASE database_name; -- ç›´æ¥åˆ é™¤æ•°æ®åº“ï¼Œä¸æ£€æŸ¥æ˜¯å¦å­˜åœ¨DROP DATABASE [IF EXISTS] database_name; æŠŠåˆšåˆšåˆ›å»ºçš„å“ˆåŸºç±³æ•°æ®åº“åˆ é™¤æ‰ MySQL 192.168.31.238:3306 ssl SQL drop database Hachimi;Query OK, 0 rows affected (0.0408 sec)MySQL 192.168.31.238:3306 ssl SQL show databases;+--------------------+| Database |+--------------------+| information_schema || mysql || performance_schema || sys |+--------------------+4 rows in set (0.0194 sec) ä½¿ç”¨æ•°æ®åº“è¦é€‰æ‹©è¦ä½¿ç”¨çš„æ•°æ®åº“ï¼Œä½¿ç”¨Â USEÂ è¯­å¥ USE æ•°æ®åº“å; ä½¿ç”¨æ•°æ®åº“ Hachimi MySQL 192.168.31.238:3306 ssl SQL use Hachimi;Default schema set to `Hachimi`.Fetching global names, object names from `Hachimi` for auto-completion... Press ^C to stop.MySQL 192.168.31.238:3306 ssl Hachimi SQL æŸ¥çœ‹æ•°æ®åº“é‡Œçš„è¡¨ï¼Œä½¿ç”¨ show tables; è¡¨çš„æ“ä½œåˆ›å»ºè¡¨ä»¥ä¸‹ä¸ºåˆ›å»º MySQL æ•°æ®è¡¨é€šç”¨è¯­æ³• CREATE TABLE [IF NOT EXISTS] è¡¨å ( åˆ—å1 æ•°æ®ç±»å‹ , åˆ—å2 æ•°æ®ç±»å‹ , ...); æ¯”å¦‚è¿™æ ·åˆ›å»ºä¸€ä¸ªç”¨æˆ·è¡¨ CREATE TABLE IF NOT EXISTS UserData ( username VARCHAR(50), userid INT, phone VARCHAR(11), isvip TINYINT(1), passwd CHAR(32), regTime DATETIME, balance DECIMAL(10, 2)); æ‰§è¡Œåçš„æ•ˆæœå¦‚ä¸‹ï¼Œä½¿ç”¨desc è¡¨åæŸ¥çœ‹è¡¨çš„æè¿° MySQL 192.168.31.238:3306 ssl Hachimi SQL show tables;+-------------------+| Tables_in_Hachimi |+-------------------+| UserData |+-------------------+1 row in set (0.0144 sec) MySQL 192.168.31.238:3306 ssl Hachimi SQL desc UserData;+----------+---------------+------+-----+---------+-------+| Field | Type | Null | Key | Default | Extra |+----------+---------------+------+-----+---------+-------+| username | varchar(50) | YES | | NULL | || userid | int | YES | | NULL | || phone | varchar(11) | YES | | NULL | || isvip | tinyint(1) | YES | | NULL | || passwd | char(32) | YES | | NULL | || regTime | datetime | YES | | NULL | || balance | decimal(10,2) | YES | | NULL | |+----------+---------------+------+-----+---------+-------+7 rows in set (0.0450 sec) MySQL 192.168.31.238:3306 ssl Hachimi SQL ä¿®æ”¹è¡¨ä¿®æ”¹åˆ—ALTER TABLE è¡¨å MODIFY COLUMN åˆ—å æ–°çš„æ•°æ®ç±»å‹; æ¯”å¦‚æˆ‘æƒ³æŠŠusernameä»æœ€é•¿50ä¸ªå­—ç¬¦æ”¹æˆæœ€é•¿30ä¸ªå­—ç¬¦ MySQL 192.168.31.238:3306 ssl Hachimi SQL ALTER TABLE UserData MODIFY COLUMN username VARCHAR(30);Query OK, 0 rows affected (0.3134 sec)Records: 0 Duplicates: 0 Warnings: 0MySQL 192.168.31.238:3306 ssl Hachimi SQL DESC UserData;+----------+---------------+------+-----+---------+-------+| Field | Type | Null | Key | Default | Extra |+----------+---------------+------+-----+---------+-------+| username | varchar(30) | YES | | NULL | || userid | int | YES | | NULL | || phone | varchar(11) | YES | | NULL | || isvip | tinyint(1) | YES | | NULL | || passwd | char(32) | YES | | NULL | || regTime | datetime | YES | | NULL | || balance | decimal(10,2) | YES | | NULL | |+----------+---------------+------+-----+---------+-------+7 rows in set (0.0174 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL MODIFY COLUMNä¸åªæ˜¯ä»…é™äºæ•°æ®ç±»å‹ æ•°æ®ç±»å‹ ALTER TABLE è¡¨å MODIFY COLUMN åˆ—å æ•°æ®ç±»å‹; æ˜¯å¦å…è®¸ NULL ALTER TABLE è¡¨å MODIFY COLUMN åˆ—å æ•°æ®ç±»å‹ NOT NULL; é»˜è®¤å€¼ ALTER TABLE è¡¨å MODIFY COLUMN åˆ—å æ•°æ®ç±»å‹ DEFAULT CURRENT_TIMESTAMP; é•¿åº¦ ç²¾åº¦ï¼ˆæ•°å­—ã€å­—ç¬¦ç±»å‹ï¼‰ ALTER TABLE è¡¨å MODIFY COLUMN åˆ—å æ•°æ®ç±»å‹ NOT NULL; ä¿®æ”¹åˆ—çš„åå­—ALTER TABLE è¡¨å RENAME COLUMN åˆ—å TO æ–°çš„åˆ—å; æ¯”å¦‚æˆ‘æƒ³æŠŠusernameæ”¹åæˆdickname MySQL 192.168.31.238:3306 ssl Hachimi SQL ALTER TABLE UserData RENAME COLUMN username TO dickname;Query OK, 0 rows affected (0.1856 sec)Records: 0 Duplicates: 0 Warnings: 0MySQL 192.168.31.238:3306 ssl Hachimi SQL DESC UserData;+----------+---------------+------+-----+---------+-------+| Field | Type | Null | Key | Default | Extra |+----------+---------------+------+-----+---------+-------+| dickname | varchar(30) | YES | | NULL | || userid | int | YES | | NULL | || phone | varchar(11) | YES | | NULL | || isvip | tinyint(1) | YES | | NULL | || passwd | char(32) | YES | | NULL | || regTime | datetime | YES | | NULL | || balance | decimal(10,2) | YES | | NULL | |+----------+---------------+------+-----+---------+-------+7 rows in set (0.0194 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL æ·»åŠ æ–°çš„åˆ—ALTER TABLE è¡¨å ADD COLUMN åˆ—å åˆ—çš„æ•°æ®ç±»å‹; æ¯”å¦‚æˆ‘æƒ³æ–°å»ºä¸€ä¸ªlast_loginåˆ— MySQL 192.168.31.238:3306 ssl Hachimi SQL ALTER TABLE UserData ADD COLUMN last_login DATETIME;Query OK, 0 rows affected (0.2408 sec)Records: 0 Duplicates: 0 Warnings: 0MySQL 192.168.31.238:3306 ssl Hachimi SQL DESC UserData;+------------+---------------+------+-----+---------+-------+| Field | Type | Null | Key | Default | Extra |+------------+---------------+------+-----+---------+-------+| dickname | varchar(30) | YES | | NULL | || userid | int | YES | | NULL | || phone | varchar(11) | YES | | NULL | || isvip | tinyint(1) | YES | | NULL | || passwd | char(32) | YES | | NULL | || regTime | datetime | YES | | NULL | || balance | decimal(10,2) | YES | | NULL | || last_login | datetime | YES | | NULL | |+------------+---------------+------+-----+---------+-------+8 rows in set (0.0150 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL åˆ é™¤åˆ—ALTER TABLE è¡¨å DROP COLUMN åˆ—å; æ¯”å¦‚æˆ‘æƒ³åˆ æ‰åˆšåˆšåˆ›å»ºçš„last_loginåˆ— MySQL 192.168.31.238:3306 ssl Hachimi SQL ALTER TABLE UserData DROP COLUMN last_login;Query OK, 0 rows affected (0.2320 sec)Records: 0 Duplicates: 0 Warnings: 0MySQL 192.168.31.238:3306 ssl Hachimi SQL DESC UserData;+----------+---------------+------+-----+---------+-------+| Field | Type | Null | Key | Default | Extra |+----------+---------------+------+-----+---------+-------+| dickname | varchar(30) | YES | | NULL | || userid | int | YES | | NULL | || phone | varchar(11) | YES | | NULL | || isvip | tinyint(1) | YES | | NULL | || passwd | char(32) | YES | | NULL | || regTime | datetime | YES | | NULL | || balance | decimal(10,2) | YES | | NULL | |+----------+---------------+------+-----+---------+-------+7 rows in set (0.0168 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL åˆ é™¤è¡¨ä½¿ç”¨DROP TABLE è¡¨åå³å¯ MySQL 192.168.31.238:3306 ssl Hachimi SQL SHOW TABLES;+-------------------+| Tables_in_Hachimi |+-------------------+| UserData |+-------------------+1 row in set (0.0167 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL DROP TABLE UserData;Query OK, 0 rows affected (0.1020 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL SHOW TABLES;Empty set (0.0730 sec) æ•°æ®çš„æ“ä½œå…ˆæŠŠåˆšåˆšåˆ æ‰çš„Hachimiè¡¨å†åˆ›å»ºå›æ¥ï¼Œä¸‹é¢æ¼”ç¤ºæ•°æ®åº“å››å¤§é‡‘åˆšå¢åˆ æŸ¥æ”¹æ“ä½œ INSERT-å¢(æ’)å•æ¡æ’å…¥INSERT INTO user (åˆ—å) VALUES (æ•°æ®); æ¯”å¦‚æˆ‘è¦å¾€UserDataé‡Œæ’å…¥ä¸€æ¡ç”¨æˆ·æ•°æ® MySQL 192.168.31.238:3306 ssl Hachimi SQL INSERT INTO UserData (username,userid,phone,isvip,passwd,regTime,balance) VALUES (å“ˆåŸºç±³,1,13988888888,0,12B2E5A579905F6FDE204ED28BA209B6,CURRENT_TIMESTAMP,16.5);Query OK, 1 row affected (0.0526 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL select * from UserData;+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| username | userid | phone | isvip | passwd | regTime | balance |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| å“ˆåŸºç±³ | 1 | 13988888888 | 0 | 12B2E5A579905F6FDE204ED28BA209B6 | 2026-01-02 08:01:58 | 16.50 |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+1 row in set (0.0161 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL å¯ä»¥çœ‹åˆ°UserDataè¡¨é‡Œå¤šäº†ä¸€ä¸ªå“ˆåŸºç±³ç”¨æˆ· å¯ä»¥ä¸æ’å…¥æ‰€æœ‰åˆ—çš„æ•°æ®ã€‚å¦‚æœä¸æ’å…¥å°±ä¼šé»˜è®¤æ˜¯NULLï¼Œå¦‚æœæœ‰è®¾ç½®é»˜è®¤å€¼çš„è¯å°±ä¼šæ˜¯é»˜è®¤å€¼ å¤šæ¡æ’å…¥INSERT INTO user (åˆ—å) VALUES (æ•°æ®),(æ•°æ®); æ¯”å¦‚æˆ‘è¦å¾€UserDataé‡Œå†æ’å…¥ä¸‰æ¡ç”¨æˆ·æ•°æ® MySQL 192.168.31.238:3306 ssl Hachimi SQL INSERT INTO UserData (username,userid,phone,isvip,passwd,regTime,balance) VALUES - (å“ˆåŸºçˆ¸,1,15564521111,0,10617BC8A54FA085DC7F3E32E89EF7E9,2026-01-02 08:00:00,14.5), - (å“ˆåŸºçˆ·,1,16512341234,0,12C544228857E7DB1A9872B5E37B5704,2026-01-02 09:00:00,12.5), - (å“ˆåŸºå­™,1,18912341234,0,BBC7180B5D0FB714FD4CC0EEB480E10B,2026-01-02 09:00:00,12.5);Query OK, 3 rows affected (0.0507 sec)Records: 3 Duplicates: 0 Warnings: 0MySQL 192.168.31.238:3306 ssl Hachimi SQL select * from UserData;+----------+--------+-------------+-------+----------------------------------+---------------------+---------+ | username | userid | phone | isvip | passwd | regTime | balance |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| å“ˆåŸºç±³ | 1 | 13988888888 | 0 | 12B2E5A579905F6FDE204ED28BA209B6 | 2026-01-02 08:01:58 | 16.50 || å“ˆåŸºçˆ¸ | 1 | 15564521111 | 0 | 10617BC8A54FA085DC7F3E32E89EF7E9 | 2026-01-02 08:00:00 | 14.50 || å“ˆåŸºçˆ· | 1 | 16512341234 | 0 | 12C544228857E7DB1A9872B5E37B5704 | 2026-01-02 09:00:00 | 12.50 || å“ˆåŸºå­™ | 1 | 18912341234 | 0 | BBC7180B5D0FB714FD4CC0EEB480E10B | 2026-01-02 09:00:00 | 12.50 |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+4 rows in set (0.0066 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL æ·»åŠ æ•°æ®æ—¶ä½¿ç”¨é»˜è®¤å€¼è¿˜è®°å¾—ä¸Šé¢çš„ä¿®æ”¹åˆ—çš„å†…å®¹å—ï¼Œå¯ä»¥ä½¿ç”¨DEFAULTæŒ‡å®šé»˜è®¤å€¼ å…ˆæŠŠisvip,regTime,balance,passwdè¿™å‡ åˆ—è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼ ALTER TABLE UserData MODIFY COLUMN isvip INT DEFAULT 0;ALTER TABLE UserData MODIFY COLUMN passwd CHAR(32) DEFAULT E10ADC3949BA59ABBE56E057F20F883E;ALTER TABLE UserData MODIFY COLUMN regTime DATETIME DEFAULT CURRENT_TIMESTAMP;ALTER TABLE UserData MODIFY COLUMN balance decimal(10,2) DEFAULT 0.0; å½“ç„¶ä¹Ÿå¯ä»¥åˆå¹¶æˆä¸€æ¡sqlä¸€æ¬¡æ€§ä¿®æ”¹ ALTER TABLE UserDataMODIFY COLUMN isvip INT DEFAULT 0,MODIFY COLUMN passwd CHAR(32) DEFAULT E10ADC3949BA59ABBE56E057F20F883E,MODIFY COLUMN regTime DATETIME DEFAULT CURRENT_TIMESTAMP,MODIFY COLUMN balance DECIMAL(10,2) DEFAULT 0.0; æ‰§è¡Œåçš„æ•ˆæœå°±æ˜¯è¿™æ · MySQL 192.168.31.238:3306 ssl Hachimi SQL desc UserData;+----------+---------------+------+-----+----------------------------------+-------------------+| Field | Type | Null | Key | Default | Extra |+----------+---------------+------+-----+----------------------------------+-------------------+| username | varchar(50) | YES | | NULL | || userid | int | YES | | NULL | || phone | varchar(11) | YES | | NULL | || isvip | int | YES | | 0 | || passwd | char(32) | YES | | E10ADC3949BA59ABBE56E057F20F883E | || regTime | datetime | YES | | CURRENT_TIMESTAMP | DEFAULT_GENERATED || balance | decimal(10,2) | YES | | 0.00 | |+----------+---------------+------+-----+----------------------------------+-------------------+7 rows in set (0.0095 sec) MySQL 192.168.31.238:3306 ssl Hachimi SQL è¿™æ—¶å€™å†æ–°å¢æ•°æ®ï¼Œåªéœ€æŒ‡å®šusername userid phoneä¸‰ä¸ªåˆ—çš„å†…å®¹ï¼Œå…¶ä½™æ²¡æœ‰æŒ‡å®šçš„å†…å®¹å°±ä¼šä½¿ç”¨é»˜è®¤å€¼ MySQL 192.168.31.238:3306 ssl Hachimi SQL INSERT INTO UserData (username,userid,phone) VALUES (å“ˆåŸºå†¯,2,13112345678);Query OK, 1 row affected (0.0322 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL select * from UserData;+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| username | userid | phone | isvip | passwd | regTime | balance |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| å“ˆåŸºç±³ | 1 | 13988888888 | 0 | 12B2E5A579905F6FDE204ED28BA209B6 | 2026-01-02 08:01:58 | 16.50 || å“ˆåŸºçˆ¸ | 1 | 15564521111 | 0 | 10617BC8A54FA085DC7F3E32E89EF7E9 | 2026-01-02 08:00:00 | 14.50 || å“ˆåŸºçˆ· | 1 | 16512341234 | 0 | 12C544228857E7DB1A9872B5E37B5704 | 2026-01-02 09:00:00 | 12.50 || å“ˆåŸºå­™ | 1 | 18912341234 | 0 | BBC7180B5D0FB714FD4CC0EEB480E10B | 2026-01-02 09:00:00 | 12.50 || å“ˆåŸºå†¯ | 2 | 13112345678 | 0 | E10ADC3949BA59ABBE56E057F20F883E | 2026-01-02 08:23:47 | 0.00 |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+5 rows in set (0.0149 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL SELECT-æŸ¥æŸ¥è¯¢çš„SQLè¯­å¥é¡ºåºè¦æ±‚å¦‚ä¸‹ é¡ºåº å…³é”®å­— ä½œç”¨ 1 SELECT é€‰å“ªäº›åˆ— 2 FROM ä»å“ªä¸ªè¡¨ 3 WHERE è¿‡æ»¤æ¡ä»¶ 4 ORDER BY æ’åº 5 LIMIT OFFSET åˆ†é¡µæˆªå– æŸ¥å…¨éƒ¨SELECT * FROM è¡¨å; æ¯”å¦‚æˆ‘è¦æŸ¥UserDataä¸‹æ‰€æœ‰æ•°æ® MySQL 192.168.31.238:3306 ssl Hachimi SQL select * from UserData;+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| username | userid | phone | isvip | passwd | regTime | balance |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| å“ˆåŸºç±³ | 1 | 13988888888 | 0 | 12B2E5A579905F6FDE204ED28BA209B6 | 2026-01-02 08:01:58 | 16.50 || å“ˆåŸºçˆ¸ | 1 | 15564521111 | 0 | 10617BC8A54FA085DC7F3E32E89EF7E9 | 2026-01-02 08:00:00 | 14.50 || å“ˆåŸºçˆ· | 1 | 16512341234 | 0 | 12C544228857E7DB1A9872B5E37B5704 | 2026-01-02 09:00:00 | 12.50 || å“ˆåŸºå­™ | 1 | 18912341234 | 0 | BBC7180B5D0FB714FD4CC0EEB480E10B | 2026-01-02 09:00:00 | 12.50 || å“ˆåŸºå†¯ | 2 | 13112345678 | 0 | E10ADC3949BA59ABBE56E057F20F883E | 2026-01-02 08:23:47 | 0.00 |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+5 rows in set (0.0172 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL æŸ¥æŒ‡å®šåˆ—SELECT åˆ—å FROM è¡¨å; --æŸ¥å•ä¸ªåˆ—SELECT åˆ—å1,åˆ—å2 FROM è¡¨å; --æŸ¥å¤šä¸ªåˆ— æ¯”å¦‚æˆ‘è¦æŸ¥UserDataä¸‹usernameå’Œphoneçš„æ•°æ® MySQL 192.168.31.238:3306 ssl Hachimi SQL select username,phone from UserData;+----------+-------------+| username | phone |+----------+-------------+| å“ˆåŸºç±³ | 13988888888 || å“ˆåŸºçˆ¸ | 15564521111 || å“ˆåŸºçˆ· | 16512341234 || å“ˆåŸºå­™ | 18912341234 || å“ˆåŸºå†¯ | 13112345678 |+----------+-------------+5 rows in set (0.0119 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL æ¡ä»¶æŸ¥è¯¢SELECT å­—æ®µ FROM è¡¨å WHERE æŸ¥è¯¢æ¡ä»¶; æŸ¥è¯¢æ¡ä»¶éœ€è¦é…åˆä¸Šé¢çš„Mysqlçš„è¿ç®—ç¬¦æ¥ä¸€èµ·ä½¿ç”¨ ç°åœ¨æ•°æ®è¡¨é‡Œéƒ½æ˜¯å“ˆåŸºä¸€å®¶äººï¼Œæ¯”å¦‚æˆ‘æƒ³æ‰¾åˆ°å“ˆåŸºå†¯çš„æ‰€æœ‰æ•°æ®æˆ–è€…å•ç‹¬æ‰¾åˆ°æ‰‹æœºå·æ•°æ® MySQL 192.168.31.238:3306 ssl Hachimi SQL select * from UserData where username like %å†¯;+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| username | userid | phone | isvip | passwd | regTime | balance |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| å“ˆåŸºå†¯ | 2 | 13112345678 | 0 | E10ADC3949BA59ABBE56E057F20F883E | 2026-01-02 08:23:47 | 0.00 |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+1 row in set (0.0170 sec) MySQL 192.168.31.238:3306 ssl Hachimi SQL select phone from UserData where username like %å†¯;+-------------+| phone |+-------------+| 13112345678 |+-------------+1 row in set (0.0189 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL å¦‚æœä½¿ç”¨LIKEï¼Œä¸åŠ %æˆ–è€…_çš„è¯å°±æ˜¯è¦æ±‚ç²¾ç¡®åŒ¹é… æ’åº + åˆ†é¡µSELECT * FROM è¡¨åORDER BY åˆ—å DESCLIMIT è¦å–å¤šå°‘æ¡ OFFSET è·³è¿‡å¤šå°‘æ¡; DESCæ˜¯æŒ‡ä»é«˜åˆ°ä½ï¼Œå¦‚æœè¦æ¢æˆä»ä½åˆ°é«˜å°±æ¢æˆASCï¼ˆæˆ–è€…å¹²è„†ä¸å†™ï¼Œå› ä¸ºé»˜è®¤å°±æ˜¯å‡åºï¼‰ æ¯”å¦‚æˆ‘è¦å–å“ˆåŸºä¸€å®¶æœ€å¯Œæœ‰çš„å‰äºŒå MySQL 192.168.31.238:3306 ssl Hachimi SQL SELECT * FROM UserData ORDER BY balance DESC LIMIT 2;+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| username | userid | phone | isvip | passwd | regTime | balance |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| å“ˆåŸºç±³ | 1 | 13988888888 | 0 | 12B2E5A579905F6FDE204ED28BA209B6 | 2026-01-02 08:01:58 | 16.50 || å“ˆåŸºçˆ¸ | 1 | 15564521111 | 0 | 10617BC8A54FA085DC7F3E32E89EF7E9 | 2026-01-02 08:00:00 | 14.50 |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+2 rows in set (0.0118 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL å¦‚æœæˆ‘è¦çœ‹ç¬¬äºŒé¡µï¼Œå°±ä½¿ç”¨OFFSET MySQL 192.168.31.238:3306 ssl Hachimi SQL SELECT * FROM UserData ORDER BY balance DESC LIMIT 2 OFFSET 2;+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| username | userid | phone | isvip | passwd | regTime | balance |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| å“ˆåŸºçˆ· | 1 | 16512341234 | 0 | 12C544228857E7DB1A9872B5E37B5704 | 2026-01-02 09:00:00 | 12.50 || å“ˆåŸºå­™ | 1 | 18912341234 | 0 | BBC7180B5D0FB714FD4CC0EEB480E10B | 2026-01-02 09:00:00 | 12.50 |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+2 rows in set (0.0052 sec) ä½¿ç”¨è¿ç®—ç¬¦å¢åŠ æŸ¥è¯¢æ¡ä»¶ï¼Œæ¯”å¦‚è¦æ±‚ä½™é¢è¿˜å¾—å¤§äº15 MySQL 192.168.31.238:3306 ssl Hachimi SQL SELECT * FROM UserData WHERE balance 15 ORDER BY balance DESC LIMIT 2 OFFSET 0;+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| username | userid | phone | isvip | passwd | regTime | balance |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| å“ˆåŸºç±³ | 1 | 13988888888 | 0 | 12B2E5A579905F6FDE204ED28BA209B6 | 2026-01-02 08:01:58 | 16.50 |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+1 row in set (0.0120 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL UPDATE-æ”¹UPDATE è¡¨å SET åˆ—å = æ•°æ® WHERE æ¡ä»¶; å…¨å±€æ›´æ–°å¦‚æœä¸åŠ WHEREçš„è¯å°±ä¼šä¿®æ”¹è¡¨å†…æ‰€æœ‰çš„æ•°æ®ã€‚æ¯”å¦‚ç°åœ¨æˆ‘è¦ç»™å“ˆåŸºä¸€å®¶å…¨éƒ½å¼€é€šVIP MySQL 192.168.31.238:3306 ssl Hachimi SQL update UserData set isvip = 1;Query OK, 5 rows affected (0.0311 sec)Rows matched: 5 Changed: 5 Warnings: 0MySQL 192.168.31.238:3306 ssl Hachimi SQL select * from UserData;+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| username | userid | phone | isvip | passwd | regTime | balance |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| å“ˆåŸºç±³ | 1 | 13988888888 | 1 | 12B2E5A579905F6FDE204ED28BA209B6 | 2026-01-02 08:01:58 | 16.50 || å“ˆåŸºçˆ¸ | 1 | 15564521111 | 1 | 10617BC8A54FA085DC7F3E32E89EF7E9 | 2026-01-02 08:00:00 | 14.50 || å“ˆåŸºçˆ· | 1 | 16512341234 | 1 | 12C544228857E7DB1A9872B5E37B5704 | 2026-01-02 09:00:00 | 12.50 || å“ˆåŸºå­™ | 1 | 18912341234 | 1 | BBC7180B5D0FB714FD4CC0EEB480E10B | 2026-01-02 09:00:00 | 12.50 || å“ˆåŸºå†¯ | 2 | 13112345678 | 1 | E10ADC3949BA59ABBE56E057F20F883E | 2026-01-02 08:23:47 | 0.00 |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+5 rows in set (0.0248 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL æ¡ä»¶æ›´æ–°é€šè¿‡WHEREæ¡ä»¶ï¼Œæ¥å•ç‹¬å†å…³æ‰å“ˆåŸºç±³çš„VIP MySQL 192.168.31.238:3306 ssl Hachimi SQL update UserData set isvip = 0 where username like å“ˆåŸºç±³;Query OK, 1 row affected (0.0387 sec)Rows matched: 1 Changed: 1 Warnings: 0MySQL 192.168.31.238:3306 ssl Hachimi SQL select * from UserData; ;+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| username | userid | phone | isvip | passwd | regTime | balance |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| å“ˆåŸºç±³ | 1 | 13988888888 | 0 | 12B2E5A579905F6FDE204ED28BA209B6 | 2026-01-02 08:01:58 | 16.50 || å“ˆåŸºçˆ¸ | 1 | 15564521111 | 1 | 10617BC8A54FA085DC7F3E32E89EF7E9 | 2026-01-02 08:00:00 | 14.50 || å“ˆåŸºçˆ· | 1 | 16512341234 | 1 | 12C544228857E7DB1A9872B5E37B5704 | 2026-01-02 09:00:00 | 12.50 || å“ˆåŸºå­™ | 1 | 18912341234 | 1 | BBC7180B5D0FB714FD4CC0EEB480E10B | 2026-01-02 09:00:00 | 12.50 || å“ˆåŸºå†¯ | 2 | 13112345678 | 1 | E10ADC3949BA59ABBE56E057F20F883E | 2026-01-02 08:23:47 | 0.00 |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+5 rows in set (0.0123 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL DELETE-åˆ DELETE FROM è¡¨å WHERE æ¡ä»¶; æ¡ä»¶åˆ é™¤æ¯”å¦‚æˆ‘è¦åˆ æ‰å“ˆåŸºç±³çš„ç”¨æˆ·æ•°æ® MySQL 192.168.31.238:3306 ssl Hachimi SQL delete from UserData where username like å“ˆåŸºç±³;Query OK, 1 row affected (0.1144 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL select * from UserData; ;+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| username | userid | phone | isvip | passwd | regTime | balance |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+| å“ˆåŸºçˆ¸ | 1 | 15564521111 | 1 | 10617BC8A54FA085DC7F3E32E89EF7E9 | 2026-01-02 08:00:00 | 14.50 || å“ˆåŸºçˆ· | 1 | 16512341234 | 1 | 12C544228857E7DB1A9872B5E37B5704 | 2026-01-02 09:00:00 | 12.50 || å“ˆåŸºå­™ | 1 | 18912341234 | 1 | BBC7180B5D0FB714FD4CC0EEB480E10B | 2026-01-02 09:00:00 | 12.50 || å“ˆåŸºå†¯ | 2 | 13112345678 | 1 | E10ADC3949BA59ABBE56E057F20F883E | 2026-01-02 08:23:47 | 0.00 |+----------+--------+-------------+-------+----------------------------------+---------------------+---------+4 rows in set (0.0283 sec) è·‘è·¯äº†å…„å¼Ÿå¦‚æœä¸åŠ WHEREå°±æ˜¯å…¨è¡¨åˆ é™¤äº† MySQL 192.168.31.238:3306 ssl Hachimi SQL delete from UserData;Query OK, 4 rows affected (0.0550 sec)MySQL 192.168.31.238:3306 ssl Hachimi SQL select * from UserData;Empty set (0.0215 sec) ä½œä¸ºsqlboyè¿˜éœ€è¦çŸ¥é“çš„â€¦1. ä»€ä¹ˆæ˜¯ä¸»é”® ï¼Ÿä¸»é”®å°±åƒæ˜¯æ¯ä¸ªäººçš„èº«ä»½è¯å·ã€‚ å”¯ä¸€æ€§ï¼šè¡¨é‡Œçš„æ¯ä¸€è¡Œæ•°æ®ï¼Œä¸»é”®å€¼å¿…é¡»æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚ éç©ºæ€§ï¼šä¸»é”®ç»å¯¹ä¸èƒ½ä¸ºç©ºï¼ˆNOT NULLï¼‰ã€‚ ä½œç”¨ï¼šå®ƒæ˜¯æ¯ä¸€è¡Œæ•°æ®çš„â€œå”¯ä¸€æ ‡è¯†â€ï¼Œæ•°æ®åº“é€šè¿‡ä¸»é”®ç²¾å‡†å®šä½æŸä¸€è¡Œã€‚ æ³¨æ„ï¼š ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚ 2. æ€ä¹ˆè®¾ç½®ä¸»é”®ï¼Ÿé€šå¸¸åœ¨åˆ›å»ºè¡¨ï¼ˆCREATE TABLEï¼‰çš„æ—¶å€™æŒ‡å®šã€‚æœ€å¸¸è§çš„æ–¹æ³•æ˜¯è®©å®ƒè‡ªåŠ¨é€’å¢ï¼ˆAUTO_INCREMENTï¼‰ï¼Œè¿™æ ·ä½ æ’å…¥æ•°æ®æ—¶å°±ä¸ç”¨ç®¡å®ƒï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨å¸®ä½ æ•°æ•°ï¼ˆ1, 2, 3â€¦ï¼‰ã€‚ åˆ›å»ºè¡¨æ—¶è®¾ç½®ï¼š CREATE TABLE Users ( userid INT PRIMARY KEY AUTO_INCREMENT, -- è®¾ç½®useridä¸ºä¸»é”®ï¼Œä¸”è‡ªåŠ¨å¢é•¿ username VARCHAR(50)); å¦‚æœè¡¨å·²ç»åˆ›å»ºäº†ï¼Œæƒ³ç»™ç°æœ‰åˆ—åŠ ä¸»é”®ï¼š ALTER TABLE UserData ADD PRIMARY KEY (userid); 3. æ€ä¹ˆé…ç½®åˆ—çš„å†…å®¹ä¸èƒ½é‡å¤ï¼Ÿå¦‚æœæƒ³è®©æŸåˆ—ï¼ˆæ¯”å¦‚æ‰‹æœºå·ã€é‚®ç®±ï¼‰ä¸é‡å¤ï¼Œä½†ä¸æŠŠå®ƒå½“æˆä¸»é”®ï¼Œå°±éœ€è¦ä½¿ç”¨ UNIQUEï¼ˆå”¯ä¸€çº¦æŸï¼‰ã€‚ åŒºåˆ«ï¼šä¸»é”®ä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªï¼Œä½† UNIQUE çº¦æŸå¯ä»¥ç»™å¾ˆå¤šåˆ—éƒ½åŠ ä¸Šã€‚ ç©ºå€¼ï¼šUNIQUE å…è®¸å†…å®¹ä¸ºç©ºï¼ˆNULLï¼‰ï¼Œä½†åªè¦æœ‰å†…å®¹ï¼Œå°±å¿…é¡»å”¯ä¸€ã€‚ ç¤ºä¾‹ï¼š CREATE TABLE UserData ( userid INT PRIMARY KEY AUTO_INCREMENT, phone VARCHAR(20) UNIQUE, -- è®¾ç½®æ‰‹æœºå·ä¸èƒ½é‡å¤ email VARCHAR(50) UNIQUE -- è®¾ç½®é‚®ç®±ä¹Ÿä¸èƒ½é‡å¤);","tags":["Mysql","Database","notebook"]},{"title":"å…³äºæˆ‘","path":"/about/index.html","content":"å¤§å­¦ç”Ÿï¼Œå•¥éƒ½ä¼š ä»Šå¹´æŠ€èƒ½ç›®æ ‡: åç«¯:golang(GinGorm) + docker + k8s + git + mysql + redis + Elasticsearch å‰ç«¯:TypeScript + React + Tailwind + Vite + uniapp å®‰å“:Kotlin ä»Šå¹´è¯ä¹¦ç›®æ ‡: TCP æˆ‘çš„Githubä¸»é¡µ ç»™æˆ‘çš„æ–°é¡¹ç›®ç‚¹ç‚¹star: GitHub - fsquirtAutoglm-Android: ä¸€æ¬¾æ— éœ€ç”µè„‘ï¼Œé€šè¿‡Shizukuæ¥è®©Autoglmæ“ä½œä½ çš„æ‰‹æœºçš„ç¨‹åº å‹é“¾å•†åŠ¡äº¤æµ:guanxiaoyu@cloudyou.top"}]